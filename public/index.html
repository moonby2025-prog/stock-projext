<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ìŠ¤í”¼/ì½”ìŠ¤ë‹¥ í†µí•© ëŒ€ì‹œë³´ë“œ (ë ˆì´ì•„ì›ƒ ê°œì„ )</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* Original App Styles - Modified for Better Readability */
        body {
            font-family: 'Inter', sans-serif;
            /* ë°°ê²½ìƒ‰ì„ slate-100ìœ¼ë¡œ ë³€ê²½í•˜ì—¬ í°ìƒ‰ ì¹´ë“œì™€ì˜ ëŒ€ë¹„ë¥¼ ê°•í™”í•©ë‹ˆë‹¤. */
            background-color: #f1f5f9; /* Tailwind slate-100 */
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .num-font { font-family: 'Roboto Mono', monospace; letter-spacing: -0.5px; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        .stock-item {
            cursor: pointer;
            padding: 0.75rem; 
            transition: all 0.2s ease;
            border-radius: 0.75rem; 
            border: 1px solid #e2e8f0; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 4.5rem; 
            background-color: white; /* ì¹´ë“œëŠ” í°ìƒ‰ ìœ ì§€ */
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); /* Light shadow */
        }
        /* Hover and Active styles remain for interaction feedback */
        .stock-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px -3px rgba(0, 0, 0, 0.1); /* Stronger shadow on hover */
            z-index: 10;
        }
        .stock-item.active {
            ring: 3px solid #4f46e5; 
            ring-offset: 1px;
            z-index: 20;
            background-color: #ffffff;
            border-color: #4f46e5;
        }
        /* Rank Badge specific styles (New) */
        .rank-badge-top {
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            border-radius: 9999px;
            font-weight: 800;
            white-space: nowrap;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            /* ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´ í”Œë ‰ìŠ¤ ì ìš© */
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1; /* ë†’ì´ ì¡°ì ˆ */
            height: 1.5rem; /* ë†’ì´ ê³ ì • */
        }
        
        /* NEW 10-rank Segmentation Badges */
        .badge-red { background-color: #ef4444; color: white; } /* Top 3 */
        .badge-top10 { background-color: #4f46e5; color: white; } /* Indigo 600 (4-10ìœ„) */
        .badge-top20 { background-color: #f59e0b; color: #1f2937; } /* Amber 500 (11-20ìœ„) */
        .badge-top30 { background-color: #14b8a6; color: white; } /* Teal 500 (21-30ìœ„) */
        .badge-default { background-color: #e5e7eb; color: #4b5563; } /* Rank 31+ (Gray) */


        /* Colors for text elements only */
        .text-up { color: #dc2626; font-weight: 700; } /* ì§„í•œ ë¹¨ê°„ìƒ‰ */
        .text-down { color: #2563eb; font-weight: 700; } /* ì§„í•œ íŒŒë€ìƒ‰ */

        .global-card {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            padding: 0.75rem; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* ê·¸ë¦¼ì ê°•í™” */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
        }
        
        /* ë©”ì¸ ì˜ì—­ ë°°ê²½ ê°•í™” */
        .main-section-card {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        /* Chart Button Styles (New) */
        .chart-button {
            border: 1px solid #e2e8f0;
            background-color: white;
            color: #475569; /* slate-600 */
        }
        .chart-button.active {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            border-color: #4f46e5;
            box-shadow: 0 2px 5px rgba(79, 70, 229, 0.3);
        }

        /* NEW: ì„¹í„° ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ (ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼) */
        .sector-icon {
            transform: scale(1);
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            /* ì•„ì´ì½˜ í¬ê¸°ê°€ ì»¤ì§€ë¯€ë¡œ ë§ˆì§„ ì¡°ì • */
            margin-right: 0.6rem !important; 
        }
        .sector-icon:hover {
            transform: scale(1.1);
        }

        /* Existing rank badge classes for Global/Filter area remain */
        .rank-badge {
            font-size: 0.6rem;
            padding: 0.1rem 0.4rem;
            border-radius: 9999px;
            font-weight: 800;
            color: white;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .rank-kospi { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .rank-kosdaq { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .loading { animation: pulse-soft 1.5s infinite; }
        @keyframes pulse-soft { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }

        /* Error Banner */
        #error-banner {
            display: none;
            background-color: #fee2e2;
            border-bottom: 1px solid #ef4444;
            color: #b91c1c;
            padding: 0.5rem;
            font-size: 0.75rem;
            text-align: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 9999;
        }
    </style>
</head>
<body class="p-3 h-screen w-screen overflow-hidden text-slate-800 flex flex-col gap-3">

    <!-- Error Diagnostic Banner -->
    <div id="error-banner"></div>

    <!-- 1. Header & Controls -->
    <!-- í—¤ë”ëŠ” ë°°ê²½ìƒ‰ ìœ ì§€ ë° ê·¸ë¦¼ì ì•½ê°„ ê°•í™” -->
    <header class="flex-none flex items-center justify-between bg-white px-4 py-3 rounded-xl shadow-md border border-slate-200 mt-2">
        <div class="flex items-center space-x-4">
            <h1 class="text-xl font-extrabold text-slate-900 tracking-tight flex items-center gap-2">
                <span>ğŸ“ˆ</span>
                <span>Market Dashboard (Simulation)</span>
            </h1>
            <!-- ë‚ ì§œ í¬ë§· ë³€ê²½ì„ ìœ„í•´ í°íŠ¸ ëª¨ë…¸ í´ë˜ìŠ¤ëŠ” ìœ ì§€ -->
            <span id="last-updated" class="text-xs text-slate-400 border-l pl-3 hidden sm:inline font-mono">
                Initialize...
            </span>
        </div>
        
        <div class="flex items-center gap-2">
            <!-- Refresh Button for "Integration" Simulation -->
            <button onclick="app.refreshData()" class="p-2 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors" title="ë°ì´í„° ìƒˆë¡œê³ ì¹¨">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </button>
            <!-- Filter Buttons: Active state managed by JS -->
            <div class="inline-flex p-1 bg-slate-100 rounded-lg">
                <button id="filter-all" onclick="app.setFilter('ALL')" class="px-3 py-1.5 text-xs font-bold rounded-md transition-all">ALL</button>
                <button id="filter-kospi" onclick="app.setFilter('KOSPI')" class="px-3 py-1.5 text-xs font-bold rounded-md transition-all">KOSPI</button>
                <button id="filter-kosdaq" onclick="app.setFilter('KOSDAQ')" class="px-3 py-1.5 text-xs font-bold rounded-md transition-all">KOSDAQ</button>
            </div>
        </div>
    </header>

    <!-- 2. Global Market Indicators (Snapshot Data) -->
    <section id="global-stats" class="flex-none grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3">
        <!-- Rendered via JS -->
    </section>
    
    <!-- 3. Main Split View -->
    <main class="flex-1 min-h-0 flex flex-col lg:flex-row gap-4">
        
        <!-- Left: Stock Map (main-section-card í´ë˜ìŠ¤ ì¶”ê°€) -->
        <section class="flex-1 main-section-card flex flex-col min-h-0 min-w-0">
            <div class="flex-none px-4 py-3 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-xl">
                <h2 class="text-sm font-bold text-slate-700 flex items-center">
                    <span class="w-1.5 h-4 bg-indigo-600 rounded-full mr-2"></span>
                    ì‹œì¥ ì§€ë„ (Market Map)
                </h2>
                <div class="text-[10px] text-slate-400 bg-white px-2 py-1 rounded border">Market Cap Weighted</div>
            </div>
            <div id="loading-overlay" class="hidden absolute inset-0 bg-white/80 z-50 flex items-center justify-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
            </div>
            <!-- NEW: ë°°ê²½ìƒ‰ì„ bg-gray-50ìœ¼ë¡œ ë³€ê²½ -->
            <div class="flex-1 overflow-y-auto p-3 custom-scroll bg-gray-50">
                <div id="industry-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3">
                    <!-- Industry Cards -->
                </div>
            </div>
        </section>

        <!-- Right: Detail Panel (main-section-card í´ë˜ìŠ¤ ì¶”ê°€) -->
        <aside class="flex-none w-full lg:w-80 main-section-card flex flex-col min-h-0">
            <!-- Detail Header -->
            <div class="flex-none p-5 border-b border-slate-50">
                <div class="flex justify-between items-start mb-1">
                    <span id="detail-badge" class="px-2 py-0.5 bg-slate-100 text-slate-600 text-[10px] font-bold rounded">MARKET</span>
                    <span id="detail-industry" class="text-xs text-slate-400 font-medium truncate ml-2">Sector</span>
                </div>
                <div class="flex justify-between items-end">
                    <h2 id="detail-name" class="text-xl font-black text-slate-900 leading-tight">Loading...</h2>
                    <span id="detail-code" class="text-xs text-slate-400 num-font mb-1">------</span>
                </div>
            </div>

            <!-- Detail Content -->
            <div class="flex-1 overflow-y-auto p-5 custom-scroll">
                <div class="mb-6">
                    <div class="flex items-baseline space-x-2">
                        <span id="detail-price" class="text-3xl font-black num-font text-slate-900">-</span>
                        <span class="text-xs text-slate-500 font-medium">KRW</span>
                    </div>
                    <div class="flex items-center mt-2 space-x-2">
                        <span id="detail-change" class="text-md font-bold num-font">-</span>
                        <span id="detail-rate" class="px-2 py-0.5 rounded text-[10px] font-bold num-font">-</span>
                    </div>
                </div>

                <!-- NEW: Chart Controls (ì¼, ì£¼, ì›” ì„ íƒ) -->
                <div id="chart-controls" class="flex justify-start space-x-2 mb-4">
                    <button onclick="app.setChartPeriod('DAY')" id="chart-day" class="chart-button text-xs px-3 py-1 rounded-full font-bold transition-colors">ì¼</button>
                    <button onclick="app.setChartPeriod('WEEK')" id="chart-week" class="chart-button text-xs px-3 py-1 rounded-full font-bold transition-colors">ì£¼</button>
                    <button onclick="app.setChartPeriod('MONTH')" id="chart-month" class="chart-button text-xs px-3 py-1 rounded-full font-bold transition-colors">ì›”</button>
                </div>

                <!-- NEW: Chart Placeholder -->
                <div id="stock-chart-placeholder" class="mb-6 bg-slate-100 p-4 h-40 flex items-center justify-center rounded-lg border border-slate-200 text-slate-400 text-sm font-medium">
                    ì°¨íŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>

                <!-- Range Bar (ì¼ì¼ ë³€ë™í­) -->
                <div class="mb-6 bg-slate-50 p-3 rounded-lg border border-slate-100">
                    <div class="flex justify-between text-[10px] text-slate-400 mb-1 font-semibold">
                        <span>Day Low</span>
                        <span>Day High</span>
                    </div>
                    <div class="w-full h-1.5 bg-slate-200 rounded-full relative mt-1">
                        <div class="absolute top-0 bottom-0 bg-slate-400 rounded-full w-full opacity-30"></div>
                        <div id="price-dot" class="w-3 h-3 bg-indigo-600 border-2 border-white rounded-full absolute top-1/2 -translate-y-1/2 shadow-sm" style="left: 50%;"></div>
                    </div>
                    <div class="flex justify-between text-[10px] num-font text-slate-400 mt-2">
                        <span id="sim-low">-</span>
                        <span id="sim-high">-</span>
                    </div>
                </div>
                
                <!-- ì¤‘ìš” ê³µì‹œì‚¬í•­ ì„¹ì…˜ -->
                <div class="mb-6 global-card p-3">
                    <h4 class="text-xs font-extrabold text-slate-700 mb-2 flex items-center">
                        <!-- Red Bell Icon for Announcement/Disclosure (Mock) -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-red-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                        ë‹¹ì¼ ì¤‘ìš” ê³µì‹œì‚¬í•­
                    </h4>
                    <div id="daily-disclosure-list" class="space-y-1 text-xs">
                        <!-- Rendered via JS -->
                    </div>
                </div>

                <!-- Real-time News Section (New) -->
                <div class="mb-6 global-card p-3">
                    <h4 class="text-xs font-extrabold text-slate-700 mb-2 flex items-center">
                        <!-- Red Newspaper Icon (Adjusted for visual appeal) -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v18"></path><path d="M12 2v20"></path><path d="M18 6h-8"></path><path d="M18 10h-8"></path><path d="M18 14h-8"></path><path d="M18 18h-8"></path><path d="M6 10h-2"></path><path d="M6 14h-2"></path><path d="M6 18h-2"></path></svg>
                        ì‹¤ì‹œê°„ ë‰´ìŠ¤ (ìµœê·¼ 5ê°œ)
                    </h4>
                    <div id="realtime-news-list" class="space-y-1"></div>
                </div>

                <!-- Analyst Report Section (New) -->
                <div class="mb-4 global-card p-3">
                    <h4 class="text-xs font-extrabold text-slate-700 mb-2 flex items-center">
                        <!-- Blue Chart Icon (Adjusted for visual appeal) -->
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-indigo-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20v-4"></path></svg>
                        ì• ë„ë¦¬ìŠ¤íŠ¸ ë³´ê³ ì„œ (ìµœê·¼ 5ê°œ)
                    </h4>
                    <div id="analyst-report-list" class="space-y-1"></div>
                </div>
            </div>

            <!-- Footer Actions (Updated based on image) -->
            <!-- ìƒì„¸ íŒ¨ë„ í•˜ë‹¨ ì˜ì—­ì€ ë°°ê²½ìƒ‰ì„ bodyì™€ ë™ì¼í•˜ê²Œ ë³€ê²½ -->
            <div class="flex-none p-3 border-t border-slate-50 bg-slate-100 rounded-b-xl grid grid-cols-1 gap-3">
                
                <a id="dart-link" href="#" target="_blank" class="flex justify-center items-center py-3 rounded-xl bg-amber-500 hover:bg-amber-600 text-white font-bold text-sm transition shadow-lg shadow-amber-200/50">
                    <!-- Icon for Document/DART (File-Text) -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
                    ì „ìê³µì‹œ (DART)
                    <!-- External Link Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                </a>
                
                <a id="naver-talk-link" href="#" target="_blank" class="flex justify-center items-center py-3 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-sm transition shadow-lg shadow-indigo-200/50">
                    <!-- Icon for Chat/Discussion (Message-Square) -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    ë„¤ì´ë²„ ì¢…ëª©í† ë¡ ë°©
                    <!-- External Link Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                </a>
            </div>
        </aside>
    </main>

    <script>
        // [Safety Check] Global Error Handler
        window.onerror = function(message, source, lineno, colno, error) {
            const banner = document.getElementById('error-banner');
            banner.style.display = 'block';
            banner.textContent = `âš ï¸ ì˜¤ë¥˜ ë°œìƒ: ${message} (Line: ${lineno}) - ì•±ì´ ì •ì§€ëœ ê²½ìš° ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.`;
            console.error("Dashboard Error:", error);
            return false;
        };

        /**
         * [API Service Layer]
         * Mock Data Service - Safe Mode with Random Change Simulation
         */
        class StockApiService {
            constructor() {
                // 2025-12-04 Base Snapshot Data (Initial State)
                this.initialDB = {
                    global: [
                        { name: 'KOSPI', value: 4023.74, change: -12.45, rate: -0.31, unit: 'P' },
                        { name: 'KOSDAQ', value: 932.01, change: 3.59, rate: 0.39, unit: 'P' },
                        // ìš”ì²­ì— ë”°ë¼ í•­ëª© ë³€ê²½
                        { name: 'NASDAQ ì„ ë¬¼', value: 20547.50, change: -10.00, rate: -0.05, unit: 'P' },
                        { name: 'USD/KRW', value: 1472.09, change: 7.00, rate: 0.47, unit: 'KRW' },
                        { name: 'Bitcoin', value: 98540, change: 1200, rate: 1.23, unit: 'USD' },
                        { name: 'Silver(XAG/USD)', value: 30.55, change: -0.25, rate: -0.81, unit: 'USD/oz' }
                    ],
                    stocks: [
                        // KOSPI Top 60
                        { rank: 1, name: 'ì‚¼ì„±ì „ì', code: '005930', market: 'KOSPI', price: 105100, change: 600, rate: 0.57, industry: 'ë°˜ë„ì²´' },
                        { rank: 2, name: 'SKí•˜ì´ë‹‰ìŠ¤', code: '000660', market: 'KOSPI', price: 542000, change: -10000, rate: -1.81, industry: 'ë°˜ë„ì²´' },
                        { rank: 3, name: 'LGì—ë„ˆì§€ì†”ë£¨ì…˜', code: '373220', market: 'KOSPI', price: 442000, change: 2000, rate: 0.45, industry: '2ì°¨ì „ì§€' },
                        { rank: 4, name: 'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤', code: '207940', market: 'KOSPI', price: 980000, change: 15000, rate: 1.55, industry: 'ë°”ì´ì˜¤' },
                        { rank: 5, name: 'í˜„ëŒ€ì°¨', code: '005380', market: 'KOSPI', price: 265000, change: -1000, rate: -0.38, industry: 'ìë™ì°¨' },
                        { rank: 6, name: 'ê¸°ì•„', code: '000270', market: 'KOSPI', price: 121000, change: 500, rate: 0.41, industry: 'ìë™ì°¨' },
                        { rank: 7, name: 'ì…€íŠ¸ë¦¬ì˜¨', code: '068270', market: 'KOSPI', price: 192000, change: -2000, rate: -1.03, industry: 'ë°”ì´ì˜¤' },
                        { rank: 8, name: 'KBê¸ˆìœµ', code: '105560', market: 'KOSPI', price: 82000, change: 1200, rate: 1.49, industry: 'ê¸ˆìœµ' },
                        { rank: 9, name: 'NAVER', code: '035420', market: 'KOSPI', price: 195000, change: -1500, rate: -0.76, industry: 'í”Œë«í¼' },
                        { rank: 10, name: 'POSCOí™€ë”©ìŠ¤', code: '005490', market: 'KOSPI', price: 455000, change: 4000, rate: 0.89, industry: 'ì² ê°•' },
                        { rank: 11, name: 'ì¹´ì¹´ì˜¤', code: '035720', market: 'KOSPI', price: 52000, change: -500, rate: -0.95, industry: 'í”Œë«í¼' },
                        { rank: 12, name: 'ì‚¼ì„±SDI', code: '006400', market: 'KOSPI', price: 385000, change: 0, rate: 0.00, industry: '2ì°¨ì „ì§€' },
                        { rank: 13, name: 'LGí™”í•™', code: '051910', market: 'KOSPI', price: 390000, change: -3000, rate: -0.76, industry: 'í™”í•™' },
                        { rank: 14, name: 'ì‹ í•œì§€ì£¼', code: '055550', market: 'KOSPI', price: 54000, change: 600, rate: 1.12, industry: 'ê¸ˆìœµ' },
                        { rank: 15, name: 'í˜„ëŒ€ëª¨ë¹„ìŠ¤', code: '012330', market: 'KOSPI', price: 245000, change: -1000, rate: -0.41, industry: 'ìë™ì°¨' },
                        { rank: 16, name: 'í¬ìŠ¤ì½”í“¨ì²˜ì— ', code: '003670', market: 'KOSPI', price: 320000, change: 5000, rate: 1.59, industry: '2ì°¨ì „ì§€' },
                        { rank: 17, name: 'í•˜ë‚˜ê¸ˆìœµì§€ì£¼', code: '086790', market: 'KOSPI', price: 62000, change: 800, rate: 1.31, industry: 'ê¸ˆìœµ' },
                        { rank: 18, name: 'LGì „ì', code: '066570', market: 'KOSPI', price: 105000, change: -500, rate: -0.47, industry: 'ITê°€ì „' },
                        { rank: 19, name: 'ì‚¼ì„±ë¬¼ì‚°', code: '028260', market: 'KOSPI', price: 145000, change: 1000, rate: 0.69, industry: 'ì§€ì£¼ì‚¬' },
                        { rank: 20, name: 'ë©”ë¦¬ì¸ ê¸ˆìœµ', code: '138040', market: 'KOSPI', price: 78000, change: 1500, rate: 1.96, industry: 'ê¸ˆìœµ' },
                        { rank: 21, name: 'SKì´ë…¸ë² ì´ì…˜', code: '096770', market: 'KOSPI', price: 115000, change: -1500, rate: -1.29, industry: 'ì •ìœ /í™”í•™' },
                        { rank: 22, name: 'í•œêµ­ì „ë ¥', code: '015760', market: 'KOSPI', price: 21000, change: 100, rate: 0.48, industry: 'ìœ í‹¸ë¦¬í‹°' },
                        { rank: 23, name: 'í¬ë˜í”„í†¤', code: '259960', market: 'KOSPI', price: 295000, change: -3000, rate: -1.01, industry: 'ê²Œì„' },
                        { rank: 24, name: 'KT&G', code: '033780', market: 'KOSPI', price: 92000, change: 500, rate: 0.55, industry: 'ìŒì‹ë£Œ' },
                        { rank: 25, name: 'ì‚¼ì„±ìƒëª…', code: '032830', market: 'KOSPI', price: 89000, change: 1000, rate: 1.14, industry: 'ë³´í—˜' },
                        { rank: 26, name: 'HDí˜„ëŒ€ì¤‘ê³µì—…', code: '329180', market: 'KOSPI', price: 135000, change: 2500, rate: 1.89, industry: 'ì¡°ì„ ' },
                        { rank: 27, name: 'ì‚¼ì„±ì „ê¸°', code: '009150', market: 'KOSPI', price: 155000, change: -500, rate: -0.32, industry: 'ITë¶€í’ˆ' },
                        { rank: 28, name: 'HMM', code: '011200', market: 'KOSPI', price: 18500, change: -200, rate: -1.07, industry: 'í•´ìš´' },
                        { rank: 29, name: 'ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°', code: '034020', market: 'KOSPI', price: 19500, change: 300, rate: 1.56, industry: 'ê¸°ê³„' },
                        { rank: 30, name: 'SKí…”ë ˆì½¤', code: '017670', market: 'KOSPI', price: 54000, change: 200, rate: 0.37, industry: 'í†µì‹ ' },
                        { rank: 31, name: 'ìš°ë¦¬ê¸ˆìœµì§€ì£¼', code: '316140', market: 'KOSPI', price: 15200, change: 100, rate: 0.66, industry: 'ê¸ˆìœµ' },
                        { rank: 32, name: 'ê¸°ì—…ì€í–‰', code: '024110', market: 'KOSPI', price: 13500, change: 50, rate: 0.37, industry: 'ê¸ˆìœµ' },
                        { rank: 33, name: 'LGìƒí™œê±´ê°•', code: '051900', market: 'KOSPI', price: 350000, change: -4000, rate: -1.13, industry: 'í™”ì¥í’ˆ' },
                        { rank: 34, name: 'S-Oil', code: '010950', market: 'KOSPI', price: 68000, change: -500, rate: -0.73, industry: 'ì •ìœ ' },
                        { rank: 35, name: 'ì‚¼ì„±í™”ì¬', code: '000810', market: 'KOSPI', price: 315000, change: 3000, rate: 0.96, industry: 'ë³´í—˜' },
                        { rank: 36, name: 'í•˜ì´ë¸Œ', code: '352820', market: 'KOSPI', price: 210000, change: -2500, rate: -1.18, industry: 'ì—”í„°' },
                        { rank: 37, name: 'ê³ ë ¤ì•„ì—°', code: '010130', market: 'KOSPI', price: 520000, change: 4000, rate: 0.78, industry: 'ì² ê°•' },
                        { rank: 38, name: 'KT', code: '030200', market: 'KOSPI', price: 38000, change: 300, rate: 0.80, industry: 'í†µì‹ ' },
                        { rank: 39, name: 'ëŒ€í•œí•­ê³µ', code: '003490', market: 'KOSPI', price: 24500, change: 200, rate: 0.82, industry: 'í•­ê³µ' },
                        { rank: 40, name: 'ì¹´ì¹´ì˜¤ë±…í¬', code: '323410', market: 'KOSPI', price: 26500, change: -300, rate: -1.12, industry: 'ê¸ˆìœµ' },
                        { rank: 41, name: 'SK', code: '034730', market: 'KOSPI', price: 165000, change: 1000, rate: 0.61, industry: 'ì§€ì£¼ì‚¬' },
                        { rank: 42, name: 'í•œêµ­ì¡°ì„ í•´ì–‘', code: '009540', market: 'KOSPI', price: 112000, change: 1500, rate: 1.36, industry: 'ì¡°ì„ ' },
                        { rank: 43, name: 'í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤', code: '012450', market: 'KOSPI', price: 195000, change: 4000, rate: 2.09, industry: 'ë°©ì‚°' },
                        { rank: 44, name: 'ì‚¼ì„±ì—ìŠ¤ë””ì—ìŠ¤', code: '018260', market: 'KOSPI', price: 155000, change: -1000, rate: -0.64, industry: 'ITì„œë¹„ìŠ¤' },
                        { rank: 45, name: 'ì—”ì”¨ì†Œí”„íŠ¸', code: '036570', market: 'KOSPI', price: 185000, change: -2000, rate: -1.07, industry: 'ê²Œì„' },
                        { rank: 46, name: 'ì•„ëª¨ë ˆí¼ì‹œí”½', code: '090430', market: 'KOSPI', price: 135000, change: -1500, rate: -1.10, industry: 'í™”ì¥í’ˆ' },
                        { rank: 47, name: 'LGì´ë…¸í…', code: '011070', market: 'KOSPI', price: 235000, change: 1000, rate: 0.43, industry: 'ITë¶€í’ˆ' },
                        { rank: 48, name: 'í•œí™”ì†”ë£¨ì…˜', code: '009830', market: 'KOSPI', price: 28500, change: -300, rate: -1.04, industry: 'í™”í•™' },
                        { rank: 49, name: 'ë¡¯ë°ì¼€ë¯¸ì¹¼', code: '011170', market: 'KOSPI', price: 125000, change: -1000, rate: -0.79, industry: 'í™”í•™' },
                        { rank: 50, name: 'HDí˜„ëŒ€ì¼ë ‰íŠ¸ë¦­', code: '267260', market: 'KOSPI', price: 185000, change: 5000, rate: 2.78, industry: 'ê¸°ê³„' },
                        { rank: 51, name: 'SKë°”ì´ì˜¤íŒœ', code: '326030', market: 'KOSPI', price: 92000, change: 1500, rate: 1.66, industry: 'ë°”ì´ì˜¤' },
                        { rank: 52, name: 'í˜„ëŒ€ì œì² ', code: '004020', market: 'KOSPI', price: 33500, change: 100, rate: 0.30, industry: 'ì² ê°•' },
                        { rank: 53, name: 'ë„·ë§ˆë¸”', code: '251270', market: 'KOSPI', price: 58000, change: -500, rate: -0.85, industry: 'ê²Œì„' },
                        { rank: 54, name: 'CJì œì¼ì œë‹¹', code: '097950', market: 'KOSPI', price: 310000, change: 2000, rate: 0.65, industry: 'ìŒì‹ë£Œ' },
                        { rank: 55, name: 'ê°•ì›ëœë“œ', code: '035250', market: 'KOSPI', price: 16500, change: 50, rate: 0.30, industry: 'ë ˆì €' },
                        { rank: 56, name: 'ìœ í•œì–‘í–‰', code: '000100', market: 'KOSPI', price: 68000, change: 800, rate: 1.19, industry: 'ì œì•½' },
                        { rank: 57, name: 'í•œë¯¸ë°˜ë„ì²´', code: '042700', market: 'KOSPI', price: 145000, change: 4500, rate: 3.20, industry: 'ë°˜ë„ì²´' },
                        { rank: 58, name: 'ê¸ˆí˜¸ì„ìœ ', code: '011780', market: 'KOSPI', price: 142000, change: -1000, rate: -0.70, industry: 'í™”í•™' },
                        { rank: 59, name: 'í˜„ëŒ€ê¸€ë¡œë¹„ìŠ¤', code: '086280', market: 'KOSPI', price: 185000, change: 1000, rate: 0.54, industry: 'ë¬¼ë¥˜' },
                        { rank: 60, name: 'F&F', code: '383220', market: 'KOSPI', price: 72000, change: -500, rate: -0.69, industry: 'ì˜ë¥˜' },

                        // KOSDAQ Top 60
                        { rank: 1, name: 'ì—ì½”í”„ë¡œë¹„ì— ', code: '247540', market: 'KOSDAQ', price: 265000, change: 5000, rate: 1.92, industry: '2ì°¨ì „ì§€' },
                        { rank: 2, name: 'ì•Œí…Œì˜¤ì  ', code: '196170', market: 'KOSDAQ', price: 345000, change: 12000, rate: 3.60, industry: 'ë°”ì´ì˜¤' },
                        { rank: 3, name: 'ì—ì½”í”„ë¡œ', code: '086520', market: 'KOSDAQ', price: 94100, change: 1100, rate: 1.27, industry: '2ì°¨ì „ì§€' },
                        { rank: 4, name: 'HLB', code: '028300', market: 'KOSDAQ', price: 82000, change: -1500, rate: -1.80, industry: 'ë°”ì´ì˜¤' },
                        { rank: 5, name: 'ë¦¬ê°€ì¼ë°”ì´ì˜¤', code: '141080', market: 'KOSDAQ', price: 125000, change: 3000, rate: 2.46, industry: 'ë°”ì´ì˜¤' },
                        { rank: 6, name: 'ì—”ì¼', code: '348370', market: 'KOSDAQ', price: 210000, change: -5000, rate: -2.33, industry: '2ì°¨ì „ì§€' },
                        { rank: 7, name: 'íœ´ì ¤', code: '145020', market: 'KOSDAQ', price: 285000, change: 2000, rate: 0.71, industry: 'ì˜ë£Œê¸°ê¸°' },
                        { rank: 8, name: 'í´ë˜ì‹œìŠ¤', code: '214150', market: 'KOSDAQ', price: 52000, change: 1500, rate: 2.97, industry: 'ì˜ë£Œê¸°ê¸°' },
                        { rank: 9, name: 'ë¦¬ë…¸ê³µì—…', code: '058470', market: 'KOSDAQ', price: 245000, change: 4000, rate: 1.66, industry: 'ë°˜ë„ì²´' },
                        { rank: 10, name: 'HPSP', code: '403870', market: 'KOSDAQ', price: 42000, change: -800, rate: -1.87, industry: 'ë°˜ë„ì²´' },
                        { rank: 11, name: 'ë ˆì¸ë³´ìš°ë¡œë³´í‹±ìŠ¤', code: '277810', market: 'KOSDAQ', price: 165000, change: 3500, rate: 2.17, industry: 'ë¡œë´‡' },
                        { rank: 12, name: 'í„ì–´ë¹„ìŠ¤', code: '263750', market: 'KOSDAQ', price: 38500, change: -500, rate: -1.28, industry: 'ê²Œì„' },
                        { rank: 13, name: 'ì…€íŠ¸ë¦¬ì˜¨ì œì•½', code: '068760', market: 'KOSDAQ', price: 92000, change: -1000, rate: -1.08, industry: 'ì œì•½' },
                        { rank: 14, name: 'ì‚¼ì²œë‹¹ì œì•½', code: '000250', market: 'KOSDAQ', price: 145000, change: 2000, rate: 1.40, industry: 'ì œì•½' },
                        { rank: 15, name: 'ì‹¤ë¦¬ì½˜íˆ¬', code: '257720', market: 'KOSDAQ', price: 42000, change: 1500, rate: 3.70, industry: 'í™”ì¥í’ˆ' },
                        { rank: 16, name: 'ì†”ë¸Œë ˆì¸', code: '357780', market: 'KOSDAQ', price: 285000, change: -2000, rate: -0.70, industry: 'ë°˜ë„ì²´' },
                        { rank: 17, name: 'JYP Ent.', code: '035900', market: 'KOSDAQ', price: 58000, change: -500, rate: -0.85, industry: 'ì—”í„°' },
                        { rank: 18, name: 'ì´ì˜¤í…Œí¬ë‹‰ìŠ¤', code: '039030', market: 'KOSDAQ', price: 175000, change: 3000, rate: 1.74, industry: 'ë°˜ë„ì²´' },
                        { rank: 19, name: 'ë™ì§„ì„ë¯¸ì¼', code: '005290', market: 'KOSDAQ', price: 38000, change: 200, rate: 0.53, industry: 'ë°˜ë„ì²´' },
                        { rank: 20, name: 'ì›ìµIPS', code: '240810', market: 'KOSDAQ', price: 34500, change: 500, rate: 1.47, industry: 'ë°˜ë„ì²´' },
                        { rank: 21, name: 'ì¹´ì¹´ì˜¤ê²Œì„ì¦ˆ', code: '293490', market: 'KOSDAQ', price: 19500, change: -200, rate: -1.02, industry: 'ê²Œì„' },
                        { rank: 22, name: 'ì—ìŠ¤ì— ', code: '041510', market: 'KOSDAQ', price: 72000, change: -1000, rate: -1.37, industry: 'ì—”í„°' },
                        { rank: 23, name: 'íŒŒë§ˆë¦¬ì„œì¹˜', code: '214450', market: 'KOSDAQ', price: 185000, change: 4000, rate: 2.21, industry: 'ì˜ë£Œê¸°ê¸°' },
                        { rank: 24, name: 'CJ ENM', code: '035760', market: 'KOSDAQ', price: 78000, change: 500, rate: 0.65, industry: 'ë¯¸ë””ì–´' },
                        { rank: 25, name: 'ìŠ¤íŠœë””ì˜¤ë“œë˜ê³¤', code: '253450', market: 'KOSDAQ', price: 42000, change: -300, rate: -0.71, industry: 'ë¯¸ë””ì–´' },
                        { rank: 26, name: 'ë”ë¸”ìœ ì”¨í”¼', code: '393890', market: 'KOSDAQ', price: 38000, change: -500, rate: -1.30, industry: '2ì°¨ì „ì§€' },
                        { rank: 27, name: 'ëŒ€ì£¼ì „ìì¬ë£Œ', code: '078600', market: 'KOSDAQ', price: 95000, change: 2000, rate: 2.15, industry: '2ì°¨ì „ì§€' },
                        { rank: 28, name: 'ë‚˜ë…¸ì‹ ì†Œì¬', code: '121600', market: 'KOSDAQ', price: 115000, change: 1500, rate: 1.32, industry: '2ì°¨ì „ì§€' },
                        { rank: 29, name: 'ì œì´ì•¤í‹°ì”¨', code: '204270', market: 'KOSDAQ', price: 22000, change: 800, rate: 3.77, industry: 'ITë¶€í’ˆ' },
                        { rank: 30, name: 'í”¼ì—”í‹°', code: '137400', market: 'KOSDAQ', price: 54000, change: -500, rate: -0.92, industry: '2ì°¨ì „ì§€' },
                        { rank: 31, name: 'ì—ìŠ¤í‹°íŒœ', code: '237690', market: 'KOSDAQ', price: 98000, change: 2000, rate: 2.08, industry: 'ë°”ì´ì˜¤' },
                        { rank: 32, name: 'ì”¨ì  ', code: '096530', market: 'KOSDAQ', price: 24500, change: 100, rate: 0.41, industry: 'ë°”ì´ì˜¤' },
                        { rank: 33, name: 'ISC', code: '095340', market: 'KOSDAQ', price: 78000, change: 1000, rate: 1.30, industry: 'ë°˜ë„ì²´' },
                        { rank: 34, name: 'í‹°ì”¨ì¼€ì´', code: '064760', market: 'KOSDAQ', price: 105000, change: -1000, rate: -0.94, industry: 'ë°˜ë„ì²´' },
                        { rank: 35, name: 'ì£¼ì„±ì—”ì§€ë‹ˆì–´ë§', code: '036930', market: 'KOSDAQ', price: 32000, change: 500, rate: 1.59, industry: 'ë°˜ë„ì²´' },
                        { rank: 36, name: 'SOOP', code: '067160', market: 'KOSDAQ', price: 115000, change: -2000, rate: -1.71, industry: 'í”Œë«í¼' },
                        { rank: 37, name: 'ì™€ì´ì§€ì—”í„°í…Œì¸ë¨¼íŠ¸', code: '122870', market: 'KOSDAQ', price: 38000, change: -500, rate: -1.30, industry: 'ì—”í„°' },
                        { rank: 38, name: 'ë„¥ìŠ¨ê²Œì„ì¦ˆ', code: '225570', market: 'KOSDAQ', price: 15500, change: 200, rate: 1.31, industry: 'ê²Œì„' },
                        { rank: 39, name: 'ë£¨ë‹›', code: '328130', market: 'KOSDAQ', price: 48000, change: 1000, rate: 2.13, industry: 'ì˜ë£ŒAI' },
                        { rank: 40, name: 'HKì´ë…¸ì—”', code: '195940', market: 'KOSDAQ', price: 42000, change: 500, rate: 1.20, industry: 'ì œì•½' },
                        { rank: 41, name: 'íœ´ì˜¨ìŠ¤', code: '243070', market: 'KOSDAQ', price: 32000, change: 100, rate: 0.31, industry: 'ì œì•½' },
                        { rank: 42, name: 'ì—ì´ë¹„ì—˜ë°”ì´ì˜¤', code: '298380', market: 'KOSDAQ', price: 34000, change: 800, rate: 2.41, industry: 'ë°”ì´ì˜¤' },
                        { rank: 43, name: 'ì˜¤ìŠ¤ì½”í…', code: '039200', market: 'KOSDAQ', price: 38000, change: 500, rate: 1.33, industry: 'ë°”ì´ì˜¤' },
                        { rank: 44, name: 'ì°¨ë°”ì´ì˜¤í…', code: '085660', market: 'KOSDAQ', price: 14500, change: -100, rate: -0.68, industry: 'ë°”ì´ì˜¤' },
                        { rank: 45, name: 'ë©”ë””í†¡ìŠ¤', code: '086900', market: 'KOSDAQ', price: 142000, change: -2000, rate: -1.39, industry: 'ë°”ì´ì˜¤' },
                        { rank: 46, name: 'íŒŒí¬ì‹œìŠ¤í…œìŠ¤', code: '140860', market: 'KOSDAQ', price: 165000, change: 3000, rate: 1.85, industry: 'ë°˜ë„ì²´' },
                        { rank: 47, name: 'ê³ ì˜', code: '098460', market: 'KOSDAQ', price: 13500, change: 100, rate: 0.75, industry: 'ë°˜ë„ì²´' },
                        { rank: 48, name: 'ì‹¬í…', code: '222800', market: 'KOSDAQ', price: 24000, change: -200, rate: -0.83, industry: 'ë°˜ë„ì²´' },
                        { rank: 49, name: 'í•˜ë‚˜ë§ˆì´í¬ë¡ ', code: '067310', market: 'KOSDAQ', price: 18500, change: 300, rate: 1.65, industry: 'ë°˜ë„ì²´' },
                        { rank: 50, name: 'ë‘ì‚°í…ŒìŠ¤ë‚˜', code: '131970', market: 'KOSDAQ', price: 38000, change: 500, rate: 1.33, industry: 'ë°˜ë„ì²´' },
                        { rank: 51, name: 'ë¹„ì—ì´ì¹˜', code: '090460', market: 'KOSDAQ', price: 19500, change: 200, rate: 1.04, industry: 'ITë¶€í’ˆ' },
                        { rank: 52, name: 'ì— ë¡œ', code: '058970', market: 'KOSDAQ', price: 62000, change: 1000, rate: 1.64, industry: 'ì†Œí”„íŠ¸ì›¨ì–´' },
                        { rank: 53, name: 'ì¹´í˜24', code: '042000', market: 'KOSDAQ', price: 28000, change: -500, rate: -1.75, industry: 'í”Œë«í¼' },
                        { rank: 54, name: 'ì•„í”„ë¦¬ì¹´TV', code: '067160', market: 'KOSDAQ', price: 105000, change: -1000, rate: -0.94, industry: 'í”Œë«í¼' },
                        { rank: 55, name: 'ìœ„ë©”ì´ë“œ', code: '112040', market: 'KOSDAQ', price: 42000, change: -1000, rate: -2.33, industry: 'ê²Œì„' },
                        { rank: 56, name: 'ì²œë³´', code: '278280', market: 'KOSDAQ', price: 75000, change: -1500, rate: -1.96, industry: '2ì°¨ì „ì§€' },
                        { rank: 57, name: 'ì„±ìš°í•˜ì´í…', code: '015750', market: 'KOSDAQ', price: 8500, change: 50, rate: 0.59, industry: 'ìë™ì°¨' },
                        { rank: 58, name: 'ì„œì§„ì‹œìŠ¤í…œ', code: '178320', market: 'KOSDAQ', price: 26000, change: 500, rate: 1.96, industry: 'í†µì‹ ì¥ë¹„' },
                        { rank: 59, name: 'ì¸í…”ë¦¬ì•ˆí…Œí¬', code: '189300', market: 'KOSDAQ', price: 58000, change: 1000, rate: 1.75, industry: 'í†µì‹ ì¥ë¹„' },
                        { rank: 60, name: 'ì œì¼ì— ì•¤ì—ìŠ¤', code: '456789', market: 'KOSDAQ', price: 18000, change: 200, rate: 1.12, industry: '2ì°¨ì „ì§€' }
                    ]
                };
                
                this.currentDB = JSON.parse(JSON.stringify(this.initialDB));
            }

            // Helper to simulate price change
            simulateChange(currentPrice) {
                // Determine step size based on price magnitude (100won for low, 1000won for mid, 5000won for high)
                let step;
                if (currentPrice > 300000) step = 5000;
                else if (currentPrice > 100000) step = 1000;
                else if (currentPrice > 10000) step = 500;
                else step = 50;

                // Randomly change price (up to +/- 2 steps, min 1 step)
                const direction = Math.random() > 0.5 ? 1 : -1;
                const magnitude = Math.floor(Math.random() * 2) + 1; // 1 or 2
                let changeAmount = step * magnitude * direction;

                // Ensure price doesn't go below 1000
                const newPrice = Math.max(1000, currentPrice + changeAmount);
                changeAmount = newPrice - currentPrice;

                const changeRate = (changeAmount / currentPrice) * 100;

                return {
                    newPrice: newPrice,
                    change: changeAmount,
                    rate: parseFloat(changeRate.toFixed(2))
                };
            }

            // [Integration Point] Simulates fetching global data with random change
            async fetchGlobalData() {
                return new Promise(resolve => {
                    setTimeout(() => {
                        this.currentDB.global = this.currentDB.global.map(item => {
                            // Determine simulation step based on unit (e.g., small change for points, larger for crypto/forex)
                            let newChange;
                            if (item.unit === 'P' || item.unit === 'KRW') {
                                newChange = (Math.random() * 10) * (Math.random() > 0.5 ? 1 : -1);
                                if (item.name === 'USD/KRW') newChange = (Math.random() * 5) * (Math.random() > 0.5 ? 1 : -1);
                            } else if (item.name === 'Bitcoin') {
                                newChange = (Math.random() * 1500) * (Math.random() > 0.5 ? 1 : -1);
                            } else if (item.name === 'Silver(XAG/USD)') {
                                newChange = (Math.random() * 0.3) * (Math.random() > 0.5 ? 1 : -1);
                            }

                            item.change = parseFloat(newChange.toFixed(2));
                            item.rate = parseFloat(((newChange / (item.value - item.change)) * 100).toFixed(2));
                            item.value = parseFloat((item.value + newChange).toFixed(2));
                            return item;
                        });
                        resolve(this.currentDB.global);
                    }, 600); // 600ms Network delay sim
                });
            }

            // [Integration Point] Simulates fetching stocks with random change
            async fetchStocks(marketFilter = 'ALL') {
                return new Promise(resolve => {
                    setTimeout(() => {
                        this.currentDB.stocks = this.currentDB.stocks.map(stock => {
                            const simulation = this.simulateChange(stock.price);
                            stock.price = simulation.newPrice;
                            stock.change = simulation.change;
                            stock.rate = simulation.rate;
                            return stock;
                        });

                        const data = this.currentDB.stocks.filter(s => 
                            marketFilter === 'ALL' ? true : s.market === marketFilter
                        );
                        resolve(data);
                    }, 400); 
                });
            }
        }

        /**
         * [Main Controller]
         * UI ì—…ë°ì´íŠ¸ ë° ì´ë²¤íŠ¸ í•¸ë“¤ë§
         */
        class DashboardApp {
            constructor() {
                this.api = new StockApiService();
                this.state = {
                    currentMarket: 'KOSDAQ', // Default to KOSDAQ as requested
                    activeCode: null,
                    chartPeriod: 'DAY', // NEW: ê¸°ë³¸ ì°¨íŠ¸ ê¸°ê°„ 'DAY'ë¡œ ì„¤ì •
                    stocks: []
                };
                
                // Elements
                this.ui = {
                    globalStats: document.getElementById('global-stats'),
                    industryGrid: document.getElementById('industry-grid'),
                    marketTitle: document.getElementById('market-title'),
                    loading: document.getElementById('loading-overlay'),
                    detail: {
                        badge: document.getElementById('detail-badge'),
                        industry: document.getElementById('detail-industry'),
                        name: document.getElementById('detail-name'),
                        code: document.getElementById('detail-code'),
                        price: document.getElementById('detail-price'),
                        change: document.getElementById('detail-change'),
                        rate: document.getElementById('detail-rate'),
                        simLow: document.getElementById('sim-low'),
                        simHigh: document.getElementById('sim-high'),
                        dot: document.getElementById('price-dot'),
                        dailyDisclosureList: document.getElementById('daily-disclosure-list'),
                        realtimeNewsList: document.getElementById('realtime-news-list'),
                        analystReportList: document.getElementById('analyst-report-list'),
                        chartPlaceholder: document.getElementById('stock-chart-placeholder'), // NEW
                        links: {
                            dart: document.getElementById('dart-link'),
                            naverTalk: document.getElementById('naver-talk-link')
                        }
                    }
                };
            }

            async init() {
                try {
                    console.log("App Initializing...");
                    this.updateTime();
                    // Set initial active button state
                    this.updateFilterButtons();
                    await this.refreshData();
                    setInterval(() => this.updateTime(), 60000); // Clock tick
                    console.log("App Initialized Successfully.");
                } catch (err) {
                    console.error("Init failed:", err);
                    document.getElementById('error-banner').style.display = 'block';
                    document.getElementById('error-banner').textContent = `ì´ˆê¸°í™” ì‹¤íŒ¨: ${err.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`;
                    throw err; // Re-throw to be caught by global handler
                }
            }

            /**
             * ì—…ë°ì´íŠ¸ ì‹œê°„ì„ 'YYYY.MM.DD (ìš”ì¼) HH:mm' í˜•ì‹ìœ¼ë¡œ í‘œì‹œí•˜ë„ë¡ ìˆ˜ì •
             */
            updateTime() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                
                const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                const weekday = weekdays[now.getDay()];

                const timeStr = `${year}.${month}.${day} (${weekday}) ${hours}:${minutes}`;
                
                document.getElementById('last-updated').textContent = `Updated ${timeStr}`;
            }

            async refreshData() {
                this.ui.loading.classList.remove('hidden');
                
                try {
                    // Parallel Data Fetching
                    const [globalData, stockData] = await Promise.all([
                        this.api.fetchGlobalData(),
                        this.api.fetchStocks(this.state.currentMarket)
                    ]);
                    
                    this.renderGlobalStats(globalData);
                    this.state.stocks = stockData;
                    this.renderStockGrid();
                    
                    if (stockData.length > 0) {
                        // If activeCode is not in the new list, select the first one
                        const target = this.state.stocks.find(s => s.code === this.state.activeCode) 
                            || stockData[0];
                        this.selectStock(target.code);
                    }
                } catch (e) {
                    console.error("Integration Error:", e);
                    throw e; // Re-throw to be caught by global handler
                } finally {
                    this.ui.loading.classList.add('hidden');
                    this.updateTime();
                }
            }

            setFilter(market) {
                this.state.currentMarket = market;
                this.state.activeCode = null; // Reset active selection when switching markets
                this.updateFilterButtons();
                this.refreshData();
            }

            updateFilterButtons() {
                ['all', 'kospi', 'kosdaq'].forEach(m => {
                    const btn = document.getElementById(`filter-${m}`);
                    const isActive = m === this.state.currentMarket.toLowerCase();
                    btn.className = isActive 
                        ? 'px-3 py-1.5 text-xs font-bold rounded-md transition-all bg-indigo-600 text-white shadow-sm'
                        : 'px-3 py-1.5 text-xs font-bold rounded-md transition-all text-slate-500 hover:bg-slate-200';
                });
            }

            renderGlobalStats(data) {
                this.ui.globalStats.innerHTML = data.map(item => {
                    const isUp = item.change > 0;
                    const colorClass = isUp ? 'text-up' : 'text-down';
                    const sign = isUp ? 'â–²' : 'â–¼';

                    // ê°’ í¬ë§·íŒ…: ì†Œìˆ˜ì  ì²˜ë¦¬
                    let valueStr;
                    if (item.name === 'Bitcoin') {
                        valueStr = Math.round(item.value).toLocaleString(); // ë¹„íŠ¸ì½”ì¸ì€ ì •ìˆ˜ë¡œ í‘œì‹œ
                    } else if (item.name === 'Silver(XAG/USD)') {
                        valueStr = item.value.toFixed(2); // ì‹¤ë²„ëŠ” ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ í‘œì‹œ
                    } else {
                        valueStr = item.value.toLocaleString(undefined, { minimumFractionDigits: item.value % 1 !== 0 ? 2 : 0, maximumFractionDigits: 2 });
                    }

                    // ë³€ë™ ê°’ í¬ë§·íŒ…
                    let changeStr;
                     if (item.name === 'Silver(XAG/USD)') {
                         changeStr = Math.abs(item.change).toFixed(2);
                     } else {
                         changeStr = Math.abs(item.change).toLocaleString(undefined, { minimumFractionDigits: item.change % 1 !== 0 ? 2 : 0, maximumFractionDigits: 2 });
                     }
                    
                    return `
                        <div class="global-card">
                            <div class="text-[10px] font-bold text-slate-500 mb-0.5 truncate uppercase tracking-wider">${item.name} (${item.unit})</div>
                            <div class="flex items-end justify-between">
                                <span class="text-sm font-black text-slate-800 num-font">${valueStr}</span>
                                <div class="flex flex-col items-end leading-none">
                                    <span class="text-[10px] font-bold ${colorClass}">${sign} ${changeStr}</span>
                                    <span class="text-[10px] font-bold ${colorClass} opacity-80 mt-0.5">${Math.abs(item.rate)}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }
            
            // New helper function to format market cap in 'ì¡°ì›' (trillions of KRW)
            formatMarketCap(price, rank) {
                // Simplified Mock Cap Calculation: A large number scaled by rank and price.
                // This formula is purely for simulation and visualization consistency.
                const baseCap = price * (100 - rank) * 10000;
                
                // Convert to KRW Trillions (ì¡°ì›)
                const trillion = 1000000000000;
                const value = baseCap / trillion;
                
                // Keep one decimal point
                return `${value.toFixed(1)}ì¡°ì›`;
            }

            // NEW: ì‚°ì—…ë³„ ì•„ì´ì½˜ SVGë¥¼ ë°˜í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜ (ê³ ìœ ì„± ê°•í™”)
            getIndustryIcon(industry) {
                // ì•„ì´ì½˜ í¬ê¸°ë¥¼ h-6 w-6ìœ¼ë¡œ í‚¤ìš°ê³ , sector-icon í´ë˜ìŠ¤ ì¶”ê°€
                const h = "h-6 w-6 sector-icon"; 
                const stroke = "stroke-2.5"; // ë‘êº¼ìš´ ì„ 

                switch (industry) {
                    case 'ë°˜ë„ì²´': 
                    case 'ITë¶€í’ˆ': 
                    case 'ITê°€ì „':
                    case 'ITì„œë¹„ìŠ¤':
                        // Chip / Circuit board (Processor icon) - ë°˜ë„ì²´ ê³ ìœ  ì•„ì´ì½˜
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-indigo-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="3" width="18" height="18" rx="2"/><path d="M7 7h10"/><path d="M7 17h10"/><path d="M7 12h10"/><path d="M12 7v10"/>
                            </svg>`;
                    case '2ì°¨ì „ì§€': 
                        // Charging Battery - ì—ë„ˆì§€ ì €ì¥
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-emerald-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="10" width="18" height="12" rx="2"/><path d="M21 6H3"/><path d="M12 14v-4l-3 4h6"/>
                            </svg>`;
                    case 'ë°”ì´ì˜¤': 
                    case 'ì œì•½': 
                    case 'ì˜ë£ŒAI':
                    case 'ì˜ë£Œê¸°ê¸°':
                        // DNA Strand - ìƒëª… ê³¼í•™/ì—°êµ¬
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-pink-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M10 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2M14 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2M18 7.5L14 12l4 4.5M6 7.5L10 12l-4 4.5"/>
                            </svg>`;
                    case 'ìë™ì°¨': 
                        // Gauge (ì†ë„ê³„) - ìš´ì†¡/ì´ë™ ì†ë„
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-slate-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 14s.5 2.5 2.5 2.5c2 0 4.5-2.5 4.5-2.5s-2.5-4.5-4.5-4.5c-2 0-2.5 2.5-2.5 2.5z"/><path d="M12 14l-4 4"/><circle cx="12" cy="12" r="10"/>
                            </svg>`;
                    case 'ê¸ˆìœµ': 
                    case 'ë³´í—˜':
                        // Scale (ì²œì¹­) - ê¸ˆìœµì˜ ê· í˜•/ê³µì •ì„±
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-green-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 3v18"/><path d="M18 13.5l-6-3-6 3"/><path d="M12 6.5L6 9.5m6-3l6 3"/><rect x="3" y="16" width="6" height="4" rx="1"/><rect x="15" y="16" width="6" height="4" rx="1"/>
                            </svg>`;
                    case 'í”Œë«í¼': 
                    case 'ê²Œì„': 
                    case 'ë¯¸ë””ì–´':
                    case 'ì—”í„°':
                        // Gamepad2 (ê²Œì„ íŒ¨ë“œ) - ë””ì§€í„¸ ì½˜í…ì¸ /ì—”í„°í…Œì¸ë¨¼íŠ¸
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-orange-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M6 12h4"/><path d="M8 10v4"/><path d="M15 11h2"/><path d="M16 10v4"/><rect x="2" y="4" width="20" height="16" rx="7"/>
                            </svg>`;
                    case 'ì² ê°•':
                    case 'ì •ìœ /í™”í•™':
                    case 'í™”í•™':
                        // Factory (ê³µì¥) - ì¤‘í›„ì¥ëŒ€ ì‚°ì—…
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-gray-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M2 20h20"/><path d="M6 20v-4"/><path d="M18 20v-4"/><path d="M12 20v-8"/><path d="M4 16v-2c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v2"/><path d="M9 12h6"/><path d="M15 12V6c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v6"/>
                            </svg>`;
                    case 'ì¡°ì„ ':
                    case 'í•´ìš´':
                    case 'í•­ê³µ':
                    case 'ë¬¼ë¥˜':
                        // Ship (ë°°) - í•´ì–‘ ìš´ì†¡ ë° ì¡°ì„ 
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M4 20h16"/><path d="M8 12h8"/><path d="M6 16l-3-4h18l-3 4z"/><path d="M10 8l2-4 2 4"/>
                            </svg>`;
                    case 'ê¸°ê³„':
                    case 'ë°©ì‚°':
                        // Cog (í†±ë‹ˆë°”í€´) - ì œì¡° ë° ê¸°ê³„
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-red-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.4 1.4 0 0 0-.8-2.6l-3.2-1.2v-3.2a1.4 1.4 0 0 0-2.6-.8l-1.2 3.2H7.6a1.4 1.4 0 0 0-.8 2.6l3.2 1.2v3.2a1.4 1.4 0 0 0 2.6.8l1.2-3.2h3.2a1.4 1.4 0 0 0 .8-2.6z"/>
                            </svg>`;
                    case 'ìŒì‹ë£Œ':
                    case 'í™”ì¥í’ˆ':
                    case 'ì˜ë¥˜':
                        // Shopping Cart (ì‡¼í•‘ ì¹´íŠ¸) - ì†Œë¹„ì¬/ìœ í†µ
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-lime-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.38a2 2 0 0 0 2-1.58L23 6H6"/>
                            </svg>`;
                    case 'ìœ í‹¸ë¦¬í‹°':
                        // Zap (ë²ˆê°œ) - ì—ë„ˆì§€/ì „ë ¥
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-yellow-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                            </svg>`;
                    case 'ì§€ì£¼ì‚¬':
                        // Building (ê±´ë¬¼/ë³¸ì‚¬) - ì§€ë°° êµ¬ì¡°
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-purple-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="10" width="18" height="12" rx="2"/><line x1="12" y1="2" x2="12" y2="10"/><line x1="7" y1="14" x2="7" y2="18"/><line x1="17" y1="14" x2="17" y2="18"/>
                            </svg>`;
                    case 'ë ˆì €':
                        // Star (ë³„) - ì—”í„°í…Œì¸ë¨¼íŠ¸/ì¸ê¸°
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-cyan-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                            </svg>`;
                    default:
                        // Default fallback
                        return `
                            <svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-purple-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
                            </svg>`;
                }
            }

            renderStockGrid() {
                const grouped = this.state.stocks.reduce((acc, stock) => {
                    const k = stock.industry;
                    if (!acc[k]) acc[k] = [];
                    acc[k].push(stock);
                    return acc;
                }, {});

                this.ui.industryGrid.innerHTML = Object.keys(grouped).map(industry => {
                    const stocks = grouped[industry];
                    // Assume all stocks in a group are from the same market for simplicity, take the market of the first stock
                    const market = stocks[0].market; 

                    // ì•„ì´ì½˜ì„ í—¬í¼ í•¨ìˆ˜ë¥¼ í†µí•´ ê°€ì ¸ì˜´
                    const industryHeaderIcon = this.getIndustryIcon(industry);

                    const itemsHtml = stocks.map(stock => {
                        const isUp = stock.rate > 0;
                        const colorClass = isUp ? 'text-up' : 'text-down';
                        const sign = isUp ? 'â–²' : 'â–¼';
                        const isActive = this.state.activeCode === stock.code ? 'active' : '';

                        // Calculate Market Cap (Mock)
                        const marketCapStr = this.formatMarketCap(stock.price, stock.rank);

                        // --- UPDATED BADGE LOGIC START ---
                        let badgeContent = `Rank ${stock.rank}`;
                        let badgeClass = 'badge-default'; // Gray for Rank
                        
                        if (stock.rank <= 3) {
                            badgeContent = `ğŸ”¥ Top 3`;
                            badgeClass = 'badge-red';
                        } else if (stock.rank <= 10) {
                            badgeContent = `ğŸš€ Top 10`;
                            badgeClass = 'badge-top10';
                        } else if (stock.rank <= 20) {
                            badgeContent = `ğŸŒŸ Top 20`;
                            badgeClass = 'badge-top20';
                        } else if (stock.rank <= 30) {
                            badgeContent = `âœ¨ Top 30`;
                            badgeClass = 'badge-top30';
                        } else {
                            // Rank 31+
                            badgeContent = `Rank ${stock.rank}`;
                            badgeClass = 'badge-default';
                        }
                        // --- UPDATED BADGE LOGIC END ---


                        const marketAbbr = stock.market === 'KOSPI' ? '(K)' : '(Q)'; // Use (K) for KOSPI, (Q) for KOSDAQ (to simulate visual difference)

                        // New Card Structure matching the image
                        return `
                            <div class="stock-item ${isActive}" onclick="app.selectStock('${stock.code}')">
                                <div class="flex flex-col space-y-1">
                                    
                                    <!-- Top Row: Name and Badge -->
                                    <div class="flex items-start justify-between">
                                        <span class="text-sm font-bold text-slate-800 truncate leading-snug">${stock.name}${marketAbbr}</span>
                                        <span class="rank-badge-top ${badgeClass} text-[10px] font-extrabold">${badgeContent}</span>
                                    </div>
                                    
                                    <!-- Price and Market Cap -->
                                    <div class="flex flex-col">
                                        <span class="text-xl font-black num-font text-slate-900 leading-tight">${stock.price.toLocaleString()}ì›</span>
                                        <span class="text-[10px] font-medium text-slate-500 whitespace-nowrap mt-0.5">ì‹œì´: ${marketCapStr}</span>
                                    </div>
                                    
                                    <!-- Change Rate -->
                                    <div class="flex items-center">
                                        <span class="text-sm font-bold ${colorClass} num-font">${sign} ${Math.abs(stock.rate)}%</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');

                    return `
                        <div class="main-section-card overflow-hidden">
                            <!-- Industry Card Header matching image style -->
                            <div class="bg-white px-4 py-3 border-b border-slate-100 flex justify-between items-center rounded-t-xl">
                                <h3 class="text-sm font-extrabold text-slate-800 flex items-center">
                                    ${industryHeaderIcon}
                                    <span>${industry} (${market})</span>
                                    <span class="text-xs font-semibold text-slate-500 ml-2">(${stocks.length}ê°œ)</span>
                                </h3>
                            </div>
                            <!-- Grid container background color changed to bg-gray-50 -->
                            <div class="p-3 grid grid-cols-2 gap-3 bg-gray-50">
                                ${itemsHtml}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            selectStock(code) {
                this.state.activeCode = code;
                this.state.chartPeriod = 'DAY'; // ì¢…ëª© ì„ íƒ ì‹œ ê¸°ë³¸ ê¸°ê°„ 'ì¼'ë¡œ ì´ˆê¸°í™”
                const stock = this.state.stocks.find(s => s.code === code);
                
                // Manually update active class to avoid full re-render flickering if possible, 
                // but for simplicity and correctness in this mock, we re-render grid to update 'active' class on cards.
                this.renderStockGrid(); 
                this.renderDetail(stock);
            }

            // NEW: ì°¨íŠ¸ ê¸°ê°„ ì„¤ì • í•¨ìˆ˜
            setChartPeriod(period) {
                this.state.chartPeriod = period;
                const stock = this.state.stocks.find(s => s.code === this.state.activeCode);
                if (stock) {
                    this.renderChart(stock);
                }
            }

            // NEW: ì°¨íŠ¸ ì˜ì—­ ë Œë”ë§ í•¨ìˆ˜ (í”Œë ˆì´ìŠ¤í™€ë”)
            renderChart(stock) {
                const periodMap = {
                    'DAY': 'ì¼ê°„ (Daily)',
                    'WEEK': 'ì£¼ê°„ (Weekly)',
                    'MONTH': 'ì›”ê°„ (Monthly)'
                };
                
                const periodName = periodMap[this.state.chartPeriod] || 'ê¸°ê°„ ì˜¤ë¥˜';
                
                // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
                document.querySelectorAll('#chart-controls .chart-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.getElementById(`chart-${this.state.chartPeriod.toLowerCase()}`).classList.add('active');

                // ì°¨íŠ¸ í”Œë ˆì´ìŠ¤í™€ë” ë‚´ìš© ì—…ë°ì´íŠ¸
                this.ui.detail.chartPlaceholder.innerHTML = `
                    <p class="text-xs text-center text-slate-500">
                        ${stock.name}ì˜ <span class="text-indigo-600 font-bold">${periodName}</span> ì°¨íŠ¸ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                        <br>
                        (ëª¨ì˜ ë°ì´í„° ì‹œê°í™” ì˜ì—­)
                    </p>
                `;
            }

            renderDetail(stock) {
                if (!stock) return;

                const d = this.ui.detail;
                const isUp = stock.rate > 0;
                const colorClass = isUp ? 'text-up' : 'text-down';
                const bgClass = isUp ? 'bg-up' : 'bg-down';

                d.badge.textContent = stock.market;
                d.badge.className = `px-2 py-0.5 text-[10px] font-bold rounded ${stock.market === 'KOSPI' ? 'bg-amber-100 text-amber-700' : 'bg-emerald-100 text-emerald-700'}`;
                
                d.industry.textContent = stock.industry;
                d.name.textContent = stock.name;
                d.code.textContent = stock.code;
                
                d.price.textContent = stock.price.toLocaleString();
                d.price.className = `text-3xl font-black num-font ${colorClass}`;
                
                d.change.textContent = `${stock.change > 0 ? 'â–²' : 'â–¼'} ${Math.abs(stock.change).toLocaleString()}`;
                d.change.className = `text-md font-bold num-font ${colorClass}`;
                
                d.rate.textContent = `${stock.rate > 0 ? '+' : ''}${stock.rate}%`;
                d.rate.className = `px-2 py-0.5 rounded text-[10px] font-bold num-font ${bgClass} ${colorClass}`;

                // Range Simulation - High/Low are recalculated based on current price for simulation
                const low = Math.round(stock.price * 0.98);
                const high = Math.round(stock.price * 1.02);
                d.simLow.textContent = low.toLocaleString();
                d.simHigh.textContent = high.toLocaleString();
                
                // Randomize dot position for "Live" feel
                const range = high - low;
                const pricePosition = stock.price - low;
                let dotPercent = (pricePosition / range) * 100;
                
                // Clamp dot position between 0% and 100%
                dotPercent = Math.max(0, Math.min(100, dotPercent));
                
                d.dot.style.left = `${dotPercent}%`;

                // Chart Rendering (Initialize or Re-render chart UI)
                this.renderChart(stock);

                // --- Mock Disclosure, News, and Report Lists ---
                
                // 1. Mock Disclosure Data
                const dailyDisclosures = [
                    [`${stock.name} - ìµœëŒ€ì£¼ì£¼ ë³€ê²½ ìˆ˜ë°˜ ì£¼ì‹ ì–‘ìˆ˜ë„ ê³„ì•½ ì²´ê²°`, 'ì¥ì¤‘ ê³µì‹œ', 'red'], 
                    [`ë‹¨ì¼ íŒë§¤/ê³µê¸‰ ê³„ì•½ ì²´ê²° (ê·œëª¨: ë§¤ì¶œì•¡ ëŒ€ë¹„ 15.5%)`, '13:30', 'blue'], 
                    [`ìê¸°ì£¼ì‹ ì·¨ë“ ê²°ì • (100ì–µ ê·œëª¨)`, '09:00', 'green'], 
                ];

                const renderDisclosureItems = (list) => {
                    if (list.length === 0) {
                        return '<p class="text-xs text-slate-500 p-2 border border-dashed rounded text-center">ì˜¤ëŠ˜ ë“±ë¡ëœ ì¤‘ìš” ê³µì‹œì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }
                    return list.map(([title, time, tagColor]) => {
                        const tagClass = tagColor === 'red' ? 'bg-red-500' : tagColor === 'blue' ? 'bg-blue-500' : 'bg-green-500';
                        return `
                            <a href="#" class="block p-2 rounded hover:bg-slate-100 transition border border-transparent group">
                                <div class="flex items-start justify-between">
                                    <span class="text-xs font-medium text-slate-800 truncate pr-2 group-hover:text-red-600">${title}</span>
                                    <span class="text-[10px] font-semibold text-white whitespace-nowrap px-1.5 py-0.5 rounded ${tagClass}">${time}</span>
                                </div>
                            </a>
                        `;
                    }).join('');
                };

                d.dailyDisclosureList.innerHTML = renderDisclosureItems(dailyDisclosures);


                // 2. Mock News Data
                const realtimeNews = [
                    [`ê¸ˆì¼ ì˜¤ì „ ê¸´ê¸‰ ì†ë³´: ${stock.industry} ì„¹í„°...`, '10ë¶„ ì „'], 
                    [`ì‹ ê·œ ì‚¬ì—… ë¶€ë¬¸ ì§„ì¶œ ì„ë°• ì†Œì‹`, '1ì‹œê°„ ì „'], 
                    [`ì°¨ì„¸ëŒ€ ê¸°ìˆ  ê°œë°œ ê´€ë ¨ íˆ¬ì ìœ ì¹˜`, 'ì–´ì œ'],
                    [`ê²½ì˜ì§„ ë³€ë™, ì‹œì¥ ê¸°ëŒ€ê° ê³ ì¡°`, '2ì¼ ì „'],
                    [`í•´ì™¸ ìˆ˜ì£¼ì•¡ ì‚¬ìƒ ìµœëŒ€ ë‹¬ì„±`, '3ì¼ ì „']
                ];

                // 3. Mock Analyst Report Data
                const analystReports = [
                    [`ë§¤ìˆ˜ ìœ ì§€ (BUY) - ëª©í‘œì£¼ê°€ ìƒí–¥`, 'ë©”ë¦¬ì¸ '],
                    [`ë¦¬ìŠ¤í¬ í•´ì†Œ, ë§¤ìˆ˜ ê¸°íšŒ í¬ì°©`, 'í•˜ë‚˜'],
                    [`ë‹¨ê¸° ì¡°ì • ê°€ëŠ¥ì„±, ë³´ìœ  ì˜ê²¬ ìœ ì§€`, 'ì‚¼ì„±'],
                    [`CAPEX ì¦ê°€, ì„±ì¥ ê°€ì† ì „ë§`, 'í‚¤ì›€'],
                    [`ë§¤ë„ ì˜ê²¬ (SELL) - ë³´ìˆ˜ì  ì ‘ê·¼`, 'KB']
                ];

                // Helper for rendering news/report list items
                const renderListItems = (list) => list.map(([title, sourceOrTime]) => {
                    return `
                        <a href="#" class="block p-2 rounded hover:bg-slate-100 transition border border-transparent group">
                            <div class="flex items-center justify-between">
                                <span class="text-xs font-medium text-slate-800 truncate pr-2 group-hover:text-indigo-600">${title}</span>
                                <span class="text-[10px] font-semibold text-slate-400 whitespace-nowrap">${sourceOrTime}</span>
                            </div>
                            <div class="text-[10px] text-slate-400 mt-0.5 truncate">${stock.name} (${stock.code})</div>
                        </a>
                    `;
                }).join('');

                d.realtimeNewsList.innerHTML = renderListItems(realtimeNews);
                d.analystReportList.innerHTML = renderListItems(analystReports);

                // Link Updates 
                d.links.dart.href = `https://dart.fss.or.kr/dsac001/main.do?&textCrpNm=${encodeURIComponent(stock.name)}`;
                d.links.naverTalk.href = `https://finance.naver.com/item/board.naver?code=${stock.code}`; // Link to discussion board
            }
        }

        // Initialize App
        const app = new DashboardApp();
        document.addEventListener('DOMContentLoaded', () => app.init());

    </script>
</body>
</html>