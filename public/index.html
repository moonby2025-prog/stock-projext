<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì½”ìŠ¤í”¼/ì½”ìŠ¤ë‹¥ í†µí•© ëŒ€ì‹œë³´ë“œ (ê¸°ì¡´ ë ˆì´ì•„ì›ƒ + ë¼ì´ë¸Œ)</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Roboto+Mono:wght@500;700&display=swap" rel="stylesheet">
    <style>
        /* [ìŠ¤íƒ€ì¼ ë³µì›] ê¸°ì¡´ ë””ìì¸ ì‹œìŠ¤í…œ ìœ ì§€ */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .num-font { font-family: 'Roboto Mono', monospace; letter-spacing: -0.5px; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ (Hover íš¨ê³¼ í¬í•¨) */
        .stock-item {
            cursor: pointer;
            padding: 0.75rem; 
            transition: all 0.2s ease;
            border-radius: 0.75rem; 
            border: 1px solid #e2e8f0; 
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 4.5rem; 
            background-color: white;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        .stock-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px -3px rgba(0, 0, 0, 0.1);
            z-index: 10;
        }
        .stock-item.active {
            ring: 3px solid #4f46e5; 
            ring-offset: 1px;
            z-index: 20;
            background-color: #ffffff;
            border-color: #4f46e5;
        }

        /* ë±ƒì§€ ìŠ¤íƒ€ì¼ (Top 3, Top 10 ë“± êµ¬ë¶„) */
        .rank-badge-top {
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            border-radius: 9999px;
            font-weight: 800;
            white-space: nowrap;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            height: 1.5rem;
        }
        .badge-red { background-color: #ef4444; color: white; }
        .badge-top10 { background-color: #4f46e5; color: white; }
        .badge-top20 { background-color: #f59e0b; color: #1f2937; }
        .badge-top30 { background-color: #14b8a6; color: white; }
        .badge-default { background-color: #e5e7eb; color: #4b5563; }

        /* í…ìŠ¤íŠ¸ ì»¬ëŸ¬ */
        .text-up { color: #dc2626; font-weight: 700; }
        .text-down { color: #2563eb; font-weight: 700; }
        .bg-up { background-color: #fee2e2; color: #991b1b; }
        .bg-down { background-color: #dbeafe; color: #1e40af; }

        /* ë ˆì´ì•„ì›ƒ ì»¨í…Œì´ë„ˆ */
        .global-card, .main-section-card {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        .main-section-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        /* ì°¨íŠ¸ ë²„íŠ¼ */
        .chart-button {
            border: 1px solid #e2e8f0;
            background-color: white;
            color: #475569;
        }
        .chart-button.active {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
            box-shadow: 0 2px 5px rgba(79, 70, 229, 0.3);
        }

        /* ì„¹í„° ì•„ì´ì½˜ */
        .sector-icon {
            transform: scale(1);
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            margin-right: 0.6rem !important; 
        }
        .sector-icon:hover { transform: scale(1.1); }

        /* ë¼ì´ë¸Œ ìƒíƒœ í‘œì‹œ (ê¹œë¹¡ì„ íš¨ê³¼) */
        .live-dot {
            height: 8px;
            width: 8px;
            background-color: #ef4444;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
            animation: blink 2s infinite;
        }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        /* ê°€ê²© ë³€ë™ ì‹œ ë°°ê²½ ê¹œë¹¡ì„ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes flash-red { 0% { background-color: #fee2e2; } 100% { background-color: transparent; } }
        @keyframes flash-blue { 0% { background-color: #dbeafe; } 100% { background-color: transparent; } }
        .flash-up { animation: flash-red 0.5s ease-out; }
        .flash-down { animation: flash-blue 0.5s ease-out; }
    </style>
</head>
<body class="p-3 h-screen w-screen overflow-hidden text-slate-800 flex flex-col gap-3">

    <!-- Header -->
    <header class="flex-none flex items-center justify-between bg-white px-4 py-3 rounded-xl shadow-md border border-slate-200 mt-2">
        <div class="flex items-center space-x-4">
            <h1 class="text-xl font-extrabold text-slate-900 tracking-tight flex items-center gap-2">
                <span>ğŸ“ˆ</span>
                <span>Market Dashboard</span>
                <span class="ml-2 px-2 py-0.5 rounded-full bg-slate-100 border border-slate-200 text-[10px] text-slate-500 font-bold flex items-center">
                    <span class="live-dot"></span> LIVE
                </span>
            </h1>
            <span id="last-updated" class="text-xs text-slate-400 border-l pl-3 hidden sm:inline font-mono">
                Connecting...
            </span>
        </div>
        
        <div class="flex items-center gap-2">
            <button onclick="app.refreshData()" class="p-2 text-slate-500 hover:text-indigo-600 hover:bg-indigo-50 rounded-lg transition-colors" title="ë°ì´í„° ìƒˆë¡œê³ ì¹¨">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </button>
            <div class="inline-flex p-1 bg-slate-100 rounded-lg">
                <button id="filter-all" onclick="app.setFilter('ALL')" class="px-3 py-1.5 text-xs font-bold rounded-md transition-all">ALL</button>
                <button id="filter-kospi" onclick="app.setFilter('KOSPI')" class="px-3 py-1.5 text-xs font-bold rounded-md transition-all">KOSPI</button>
                <button id="filter-kosdaq" onclick="app.setFilter('KOSDAQ')" class="px-3 py-1.5 text-xs font-bold rounded-md transition-all">KOSDAQ</button>
            </div>
        </div>
    </header>

    <!-- Global Indicators -->
    <section id="global-stats" class="flex-none grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3">
        <!-- JS Rendered -->
    </section>
    
    <!-- Main Content -->
    <main class="flex-1 min-h-0 flex flex-col lg:flex-row gap-4">
        
        <!-- Stock Map (Left Side) -->
        <section class="flex-1 main-section-card flex flex-col min-h-0 min-w-0">
            <div class="flex-none px-4 py-3 border-b border-slate-100 flex justify-between items-center bg-slate-50 rounded-t-xl">
                <h2 class="text-sm font-bold text-slate-700 flex items-center">
                    <span class="w-1.5 h-4 bg-indigo-600 rounded-full mr-2"></span>
                    ì‹œì¥ ì§€ë„ (Market Map)
                </h2>
                <div class="text-[10px] text-slate-400 bg-white px-2 py-1 rounded border">Market Cap Weighted</div>
            </div>
            
            <div id="loading-overlay" class="hidden absolute inset-0 bg-white/80 z-50 flex items-center justify-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
            </div>

            <!-- ìŠ¤í¬ë¡¤ ì˜ì—­ ë°°ê²½ìƒ‰ ê¸°ì¡´ íšŒìƒ‰í†¤ ìœ ì§€ -->
            <div class="flex-1 overflow-y-auto p-3 custom-scroll bg-gray-50">
                <div id="industry-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3">
                    <!-- Cards will be rendered here by JS -->
                </div>
            </div>
        </section>

        <!-- Detail Panel (Right Side) -->
        <aside class="flex-none w-full lg:w-80 main-section-card flex flex-col min-h-0">
            <!-- Header -->
            <div class="flex-none p-5 border-b border-slate-50">
                <div class="flex justify-between items-start mb-1">
                    <span id="detail-badge" class="px-2 py-0.5 bg-slate-100 text-slate-600 text-[10px] font-bold rounded">MARKET</span>
                    <span id="detail-industry" class="text-xs text-slate-400 font-medium truncate ml-2">Sector</span>
                </div>
                <div class="flex justify-between items-end">
                    <h2 id="detail-name" class="text-xl font-black text-slate-900 leading-tight">Loading...</h2>
                    <span id="detail-code" class="text-xs text-slate-400 num-font mb-1">------</span>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-5 custom-scroll">
                <!-- ê°€ê²© í‘œì‹œ ì˜ì—­ (ê¹œë¹¡ì„ íš¨ê³¼ ì ìš© ëŒ€ìƒ) -->
                <div id="price-container" class="mb-6 rounded p-2 -m-2 transition-colors duration-300">
                    <div class="flex items-baseline space-x-2">
                        <span id="detail-price" class="text-3xl font-black num-font text-slate-900">-</span>
                        <span class="text-xs text-slate-500 font-medium">KRW</span>
                    </div>
                    <div class="flex items-center mt-2 space-x-2">
                        <span id="detail-change" class="text-md font-bold num-font">-</span>
                        <span id="detail-rate" class="px-2 py-0.5 rounded text-[10px] font-bold num-font">-</span>
                    </div>
                </div>

                <div id="chart-controls" class="flex justify-start space-x-2 mb-4">
                    <button onclick="app.setChartPeriod('DAY')" id="chart-day" class="chart-button text-xs px-3 py-1 rounded-full font-bold transition-colors">ì¼</button>
                    <button onclick="app.setChartPeriod('WEEK')" id="chart-week" class="chart-button text-xs px-3 py-1 rounded-full font-bold transition-colors">ì£¼</button>
                    <button onclick="app.setChartPeriod('MONTH')" id="chart-month" class="chart-button text-xs px-3 py-1 rounded-full font-bold transition-colors">ì›”</button>
                </div>

                <div id="stock-chart-placeholder" class="mb-6 bg-slate-100 p-4 h-40 flex flex-col items-center justify-center rounded-lg border border-slate-200 text-slate-400 text-sm font-medium text-center">
                    <span>ì°¨íŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                    <span class="text-[10px] text-slate-400 mt-2 font-normal">(Live Data Simulation)</span>
                </div>

                <div class="mb-6 bg-slate-50 p-3 rounded-lg border border-slate-100">
                    <div class="flex justify-between text-[10px] text-slate-400 mb-1 font-semibold">
                        <span>Day Low</span>
                        <span>Day High</span>
                    </div>
                    <div class="w-full h-1.5 bg-slate-200 rounded-full relative mt-1">
                        <div class="absolute top-0 bottom-0 bg-slate-400 rounded-full w-full opacity-30"></div>
                        <div id="price-dot" class="w-3 h-3 bg-indigo-600 border-2 border-white rounded-full absolute top-1/2 -translate-y-1/2 shadow-sm transition-all duration-500" style="left: 50%;"></div>
                    </div>
                    <div class="flex justify-between text-[10px] num-font text-slate-400 mt-2">
                        <span id="sim-low">-</span>
                        <span id="sim-high">-</span>
                    </div>
                </div>
                
                <div class="mb-6 global-card p-3">
                    <h4 class="text-xs font-extrabold text-slate-700 mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-red-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                        ë‹¹ì¼ ì¤‘ìš” ê³µì‹œì‚¬í•­
                    </h4>
                    <div id="daily-disclosure-list" class="space-y-1 text-xs"></div>
                </div>

                <div class="mb-6 global-card p-3">
                    <h4 class="text-xs font-extrabold text-slate-700 mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-red-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v18"></path><path d="M12 2v20"></path><path d="M18 6h-8"></path><path d="M18 10h-8"></path><path d="M18 14h-8"></path><path d="M18 18h-8"></path><path d="M6 10h-2"></path><path d="M6 14h-2"></path><path d="M6 18h-2"></path></svg>
                        ì‹¤ì‹œê°„ ë‰´ìŠ¤ (ìµœê·¼ 5ê°œ)
                    </h4>
                    <div id="realtime-news-list" class="space-y-1"></div>
                </div>

                <div class="mb-4 global-card p-3">
                    <h4 class="text-xs font-extrabold text-slate-700 mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-indigo-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20V10"></path><path d="M18 20V4"></path><path d="M6 20v-4"></path></svg>
                        ì• ë„ë¦¬ìŠ¤íŠ¸ ë³´ê³ ì„œ (ìµœê·¼ 5ê°œ)
                    </h4>
                    <div id="analyst-report-list" class="space-y-1"></div>
                </div>
            </div>

            <!-- Footer -->
            <div class="flex-none p-3 border-t border-slate-50 bg-slate-100 rounded-b-xl grid grid-cols-1 gap-3">
                <a id="dart-link" href="#" target="_blank" class="flex justify-center items-center py-3 rounded-xl bg-amber-500 hover:bg-amber-600 text-white font-bold text-sm transition shadow-lg shadow-amber-200/50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>
                    ì „ìê³µì‹œ (DART)
                </a>
                <a id="naver-talk-link" href="#" target="_blank" class="flex justify-center items-center py-3 rounded-xl bg-indigo-600 hover:bg-indigo-700 text-white font-bold text-sm transition shadow-lg shadow-indigo-200/50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    ë„¤ì´ë²„ ì¢…ëª©í† ë¡ ë°©
                </a>
            </div>
        </aside>
    </main>

    <script>
        /**
         * [API ì—”ì§„] ì‹¤ì‹œê°„ ê°€ê²© ì‹œë®¬ë ˆì´ì…˜ ë° ë°ì´í„° ê´€ë¦¬
         * ì´ ë¶€ë¶„ì€ Vercel ë°°í¬ ì „ê¹Œì§€ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
         */
        class StockApiService {
            constructor() {
                // ê¸°ë³¸ ë°ì´í„° ì„¸íŠ¸ (ì„œë²„ DB ëŒ€ìš©)
                this.initialDB = {
                    global: [
                        { name: 'KOSPI', value: 4023.74, change: -12.45, rate: -0.31, unit: 'P' },
                        { name: 'KOSDAQ', value: 932.01, change: 3.59, rate: 0.39, unit: 'P' },
                        { name: 'NASDAQ ì„ ë¬¼', value: 20547.50, change: -10.00, rate: -0.05, unit: 'P' },
                        { name: 'USD/KRW', value: 1472.09, change: 7.00, rate: 0.47, unit: 'KRW' },
                        { name: 'Bitcoin', value: 98540, change: 1200, rate: 1.23, unit: 'USD' },
                        { name: 'Silver(XAG/USD)', value: 30.55, change: -0.25, rate: -0.81, unit: 'USD/oz' }
                    ],
                    stocks: [
                        // KOSPI Top 60
                        { rank: 1, name: 'ì‚¼ì„±ì „ì', code: '005930', market: 'KOSPI', price: 105100, change: 600, rate: 0.57, industry: 'ë°˜ë„ì²´' },
                        { rank: 2, name: 'SKí•˜ì´ë‹‰ìŠ¤', code: '000660', market: 'KOSPI', price: 542000, change: -10000, rate: -1.81, industry: 'ë°˜ë„ì²´' },
                        { rank: 3, name: 'LGì—ë„ˆì§€ì†”ë£¨ì…˜', code: '373220', market: 'KOSPI', price: 442000, change: 2000, rate: 0.45, industry: '2ì°¨ì „ì§€' },
                        { rank: 4, name: 'ì‚¼ì„±ë°”ì´ì˜¤ë¡œì§ìŠ¤', code: '207940', market: 'KOSPI', price: 980000, change: 15000, rate: 1.55, industry: 'ë°”ì´ì˜¤' },
                        { rank: 5, name: 'í˜„ëŒ€ì°¨', code: '005380', market: 'KOSPI', price: 265000, change: -1000, rate: -0.38, industry: 'ìë™ì°¨' },
                        { rank: 6, name: 'ê¸°ì•„', code: '000270', market: 'KOSPI', price: 121000, change: 500, rate: 0.41, industry: 'ìë™ì°¨' },
                        { rank: 7, name: 'ì…€íŠ¸ë¦¬ì˜¨', code: '068270', market: 'KOSPI', price: 192000, change: -2000, rate: -1.03, industry: 'ë°”ì´ì˜¤' },
                        { rank: 8, name: 'KBê¸ˆìœµ', code: '105560', market: 'KOSPI', price: 82000, change: 1200, rate: 1.49, industry: 'ê¸ˆìœµ' },
                        { rank: 9, name: 'NAVER', code: '035420', market: 'KOSPI', price: 195000, change: -1500, rate: -0.76, industry: 'í”Œë«í¼' },
                        { rank: 10, name: 'POSCOí™€ë”©ìŠ¤', code: '005490', market: 'KOSPI', price: 455000, change: 4000, rate: 0.89, industry: 'ì² ê°•' },
                        { rank: 11, name: 'ì¹´ì¹´ì˜¤', code: '035720', market: 'KOSPI', price: 52000, change: -500, rate: -0.95, industry: 'í”Œë«í¼' },
                        { rank: 12, name: 'ì‚¼ì„±SDI', code: '006400', market: 'KOSPI', price: 385000, change: 0, rate: 0.00, industry: '2ì°¨ì „ì§€' },
                        { rank: 13, name: 'LGí™”í•™', code: '051910', market: 'KOSPI', price: 390000, change: -3000, rate: -0.76, industry: 'í™”í•™' },
                        { rank: 14, name: 'ì‹ í•œì§€ì£¼', code: '055550', market: 'KOSPI', price: 54000, change: 600, rate: 1.12, industry: 'ê¸ˆìœµ' },
                        { rank: 15, name: 'í˜„ëŒ€ëª¨ë¹„ìŠ¤', code: '012330', market: 'KOSPI', price: 245000, change: -1000, rate: -0.41, industry: 'ìë™ì°¨' },
                        { rank: 16, name: 'í¬ìŠ¤ì½”í“¨ì²˜ì— ', code: '003670', market: 'KOSPI', price: 320000, change: 5000, rate: 1.59, industry: '2ì°¨ì „ì§€' },
                        { rank: 17, name: 'í•˜ë‚˜ê¸ˆìœµì§€ì£¼', code: '086790', market: 'KOSPI', price: 62000, change: 800, rate: 1.31, industry: 'ê¸ˆìœµ' },
                        { rank: 18, name: 'LGì „ì', code: '066570', market: 'KOSPI', price: 105000, change: -500, rate: -0.47, industry: 'ITê°€ì „' },
                        { rank: 19, name: 'ì‚¼ì„±ë¬¼ì‚°', code: '028260', market: 'KOSPI', price: 145000, change: 1000, rate: 0.69, industry: 'ì§€ì£¼ì‚¬' },
                        { rank: 20, name: 'ë©”ë¦¬ì¸ ê¸ˆìœµ', code: '138040', market: 'KOSPI', price: 78000, change: 1500, rate: 1.96, industry: 'ê¸ˆìœµ' },
                        { rank: 21, name: 'SKì´ë…¸ë² ì´ì…˜', code: '096770', market: 'KOSPI', price: 115000, change: -1500, rate: -1.29, industry: 'ì •ìœ /í™”í•™' },
                        { rank: 22, name: 'í•œêµ­ì „ë ¥', code: '015760', market: 'KOSPI', price: 21000, change: 100, rate: 0.48, industry: 'ìœ í‹¸ë¦¬í‹°' },
                        { rank: 23, name: 'í¬ë˜í”„í†¤', code: '259960', market: 'KOSPI', price: 295000, change: -3000, rate: -1.01, industry: 'ê²Œì„' },
                        { rank: 24, name: 'KT&G', code: '033780', market: 'KOSPI', price: 92000, change: 500, rate: 0.55, industry: 'ìŒì‹ë£Œ' },
                        { rank: 25, name: 'ì‚¼ì„±ìƒëª…', code: '032830', market: 'KOSPI', price: 89000, change: 1000, rate: 1.14, industry: 'ë³´í—˜' },
                        { rank: 26, name: 'HDí˜„ëŒ€ì¤‘ê³µì—…', code: '329180', market: 'KOSPI', price: 135000, change: 2500, rate: 1.89, industry: 'ì¡°ì„ ' },
                        { rank: 27, name: 'ì‚¼ì„±ì „ê¸°', code: '009150', market: 'KOSPI', price: 155000, change: -500, rate: -0.32, industry: 'ITë¶€í’ˆ' },
                        { rank: 28, name: 'HMM', code: '011200', market: 'KOSPI', price: 18500, change: -200, rate: -1.07, industry: 'í•´ìš´' },
                        { rank: 29, name: 'ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°', code: '034020', market: 'KOSPI', price: 19500, change: 300, rate: 1.56, industry: 'ê¸°ê³„' },
                        { rank: 30, name: 'SKí…”ë ˆì½¤', code: '017670', market: 'KOSPI', price: 54000, change: 200, rate: 0.37, industry: 'í†µì‹ ' },
                        { rank: 31, name: 'ìš°ë¦¬ê¸ˆìœµì§€ì£¼', code: '316140', market: 'KOSPI', price: 15200, change: 100, rate: 0.66, industry: 'ê¸ˆìœµ' },
                        { rank: 32, name: 'ê¸°ì—…ì€í–‰', code: '024110', market: 'KOSPI', price: 13500, change: 50, rate: 0.37, industry: 'ê¸ˆìœµ' },
                        { rank: 33, name: 'LGìƒí™œê±´ê°•', code: '051900', market: 'KOSPI', price: 350000, change: -4000, rate: -1.13, industry: 'í™”ì¥í’ˆ' },
                        { rank: 34, name: 'S-Oil', code: '010950', market: 'KOSPI', price: 68000, change: -500, rate: -0.73, industry: 'ì •ìœ ' },
                        { rank: 35, name: 'ì‚¼ì„±í™”ì¬', code: '000810', market: 'KOSPI', price: 315000, change: 3000, rate: 0.96, industry: 'ë³´í—˜' },
                        { rank: 36, name: 'í•˜ì´ë¸Œ', code: '352820', market: 'KOSPI', price: 210000, change: -2500, rate: -1.18, industry: 'ì—”í„°' },
                        { rank: 37, name: 'ê³ ë ¤ì•„ì—°', code: '010130', market: 'KOSPI', price: 520000, change: 4000, rate: 0.78, industry: 'ì² ê°•' },
                        { rank: 38, name: 'KT', code: '030200', market: 'KOSPI', price: 38000, change: 300, rate: 0.80, industry: 'í†µì‹ ' },
                        { rank: 39, name: 'ëŒ€í•œí•­ê³µ', code: '003490', market: 'KOSPI', price: 24500, change: 200, rate: 0.82, industry: 'í•­ê³µ' },
                        { rank: 40, name: 'ì¹´ì¹´ì˜¤ë±…í¬', code: '323410', market: 'KOSPI', price: 26500, change: -300, rate: -1.12, industry: 'ê¸ˆìœµ' },
                        { rank: 41, name: 'SK', code: '034730', market: 'KOSPI', price: 165000, change: 1000, rate: 0.61, industry: 'ì§€ì£¼ì‚¬' },
                        { rank: 42, name: 'í•œêµ­ì¡°ì„ í•´ì–‘', code: '009540', market: 'KOSPI', price: 112000, change: 1500, rate: 1.36, industry: 'ì¡°ì„ ' },
                        { rank: 43, name: 'í•œí™”ì—ì–´ë¡œìŠ¤í˜ì´ìŠ¤', code: '012450', market: 'KOSPI', price: 195000, change: 4000, rate: 2.09, industry: 'ë°©ì‚°' },
                        { rank: 44, name: 'ì‚¼ì„±ì—ìŠ¤ë””ì—ìŠ¤', code: '018260', market: 'KOSPI', price: 155000, change: -1000, rate: -0.64, industry: 'ITì„œë¹„ìŠ¤' },
                        { rank: 45, name: 'ì—”ì”¨ì†Œí”„íŠ¸', code: '036570', market: 'KOSPI', price: 185000, change: -2000, rate: -1.07, industry: 'ê²Œì„' },
                        { rank: 46, name: 'ì•„ëª¨ë ˆí¼ì‹œí”½', code: '090430', market: 'KOSPI', price: 135000, change: -1500, rate: -1.10, industry: 'í™”ì¥í’ˆ' },
                        { rank: 47, name: 'LGì´ë…¸í…', code: '011070', market: 'KOSPI', price: 235000, change: 1000, rate: 0.43, industry: 'ITë¶€í’ˆ' },
                        { rank: 48, name: 'í•œí™”ì†”ë£¨ì…˜', code: '009830', market: 'KOSPI', price: 28500, change: -300, rate: -1.04, industry: 'í™”í•™' },
                        { rank: 49, name: 'ë¡¯ë°ì¼€ë¯¸ì¹¼', code: '011170', market: 'KOSPI', price: 125000, change: -1000, rate: -0.79, industry: 'í™”í•™' },
                        { rank: 50, name: 'HDí˜„ëŒ€ì¼ë ‰íŠ¸ë¦­', code: '267260', market: 'KOSPI', price: 185000, change: 5000, rate: 2.78, industry: 'ê¸°ê³„' },
                        { rank: 51, name: 'SKë°”ì´ì˜¤íŒœ', code: '326030', market: 'KOSPI', price: 92000, change: 1500, rate: 1.66, industry: 'ë°”ì´ì˜¤' },
                        { rank: 52, name: 'í˜„ëŒ€ì œì² ', code: '004020', market: 'KOSPI', price: 33500, change: 100, rate: 0.30, industry: 'ì² ê°•' },
                        { rank: 53, name: 'ë„·ë§ˆë¸”', code: '251270', market: 'KOSPI', price: 58000, change: -500, rate: -0.85, industry: 'ê²Œì„' },
                        { rank: 54, name: 'CJì œì¼ì œë‹¹', code: '097950', market: 'KOSPI', price: 310000, change: 2000, rate: 0.65, industry: 'ìŒì‹ë£Œ' },
                        { rank: 55, name: 'ê°•ì›ëœë“œ', code: '035250', market: 'KOSPI', price: 16500, change: 50, rate: 0.30, industry: 'ë ˆì €' },
                        { rank: 56, name: 'ìœ í•œì–‘í–‰', code: '000100', market: 'KOSPI', price: 68000, change: 800, rate: 1.19, industry: 'ì œì•½' },
                        { rank: 57, name: 'í•œë¯¸ë°˜ë„ì²´', code: '042700', market: 'KOSPI', price: 145000, change: 4500, rate: 3.20, industry: 'ë°˜ë„ì²´' },
                        { rank: 58, name: 'ê¸ˆí˜¸ì„ìœ ', code: '011780', market: 'KOSPI', price: 142000, change: -1000, rate: -0.70, industry: 'í™”í•™' },
                        { rank: 59, name: 'í˜„ëŒ€ê¸€ë¡œë¹„ìŠ¤', code: '086280', market: 'KOSPI', price: 185000, change: 1000, rate: 0.54, industry: 'ë¬¼ë¥˜' },
                        { rank: 60, name: 'F&F', code: '383220', market: 'KOSPI', price: 72000, change: -500, rate: -0.69, industry: 'ì˜ë¥˜' },

                        // KOSDAQ Top 60
                        { rank: 1, name: 'ì—ì½”í”„ë¡œë¹„ì— ', code: '247540', market: 'KOSDAQ', price: 265000, change: 5000, rate: 1.92, industry: '2ì°¨ì „ì§€' },
                        { rank: 2, name: 'ì•Œí…Œì˜¤ì  ', code: '196170', market: 'KOSDAQ', price: 345000, change: 12000, rate: 3.60, industry: 'ë°”ì´ì˜¤' },
                        { rank: 3, name: 'ì—ì½”í”„ë¡œ', code: '086520', market: 'KOSDAQ', price: 94100, change: 1100, rate: 1.27, industry: '2ì°¨ì „ì§€' },
                        { rank: 4, name: 'HLB', code: '028300', market: 'KOSDAQ', price: 82000, change: -1500, rate: -1.80, industry: 'ë°”ì´ì˜¤' },
                        { rank: 5, name: 'ë¦¬ê°€ì¼ë°”ì´ì˜¤', code: '141080', market: 'KOSDAQ', price: 125000, change: 3000, rate: 2.46, industry: 'ë°”ì´ì˜¤' },
                        { rank: 6, name: 'ì—”ì¼', code: '348370', market: 'KOSDAQ', price: 210000, change: -5000, rate: -2.33, industry: '2ì°¨ì „ì§€' },
                        { rank: 7, name: 'íœ´ì ¤', code: '145020', market: 'KOSDAQ', price: 285000, change: 2000, rate: 0.71, industry: 'ì˜ë£Œê¸°ê¸°' },
                        { rank: 8, name: 'í´ë˜ì‹œìŠ¤', code: '214150', market: 'KOSDAQ', price: 52000, change: 1500, rate: 2.97, industry: 'ì˜ë£Œê¸°ê¸°' },
                        { rank: 9, name: 'ë¦¬ë…¸ê³µì—…', code: '058470', market: 'KOSDAQ', price: 245000, change: 4000, rate: 1.66, industry: 'ë°˜ë„ì²´' },
                        { rank: 10, name: 'HPSP', code: '403870', market: 'KOSDAQ', price: 42000, change: -800, rate: -1.87, industry: 'ë°˜ë„ì²´' },
                        { rank: 11, name: 'ë ˆì¸ë³´ìš°ë¡œë³´í‹±ìŠ¤', code: '277810', market: 'KOSDAQ', price: 165000, change: 3500, rate: 2.17, industry: 'ë¡œë´‡' },
                        { rank: 12, name: 'í„ì–´ë¹„ìŠ¤', code: '263750', market: 'KOSDAQ', price: 38500, change: -500, rate: -1.28, industry: 'ê²Œì„' },
                        { rank: 13, name: 'ì…€íŠ¸ë¦¬ì˜¨ì œì•½', code: '068760', market: 'KOSDAQ', price: 92000, change: -1000, rate: -1.08, industry: 'ì œì•½' },
                        { rank: 14, name: 'ì‚¼ì²œë‹¹ì œì•½', code: '000250', market: 'KOSDAQ', price: 145000, change: 2000, rate: 1.40, industry: 'ì œì•½' },
                        { rank: 15, name: 'ì‹¤ë¦¬ì½˜íˆ¬', code: '257720', market: 'KOSDAQ', price: 42000, change: 1500, rate: 3.70, industry: 'í™”ì¥í’ˆ' },
                        { rank: 16, name: 'ì†”ë¸Œë ˆì¸', code: '357780', market: 'KOSDAQ', price: 285000, change: -2000, rate: -0.70, industry: 'ë°˜ë„ì²´' },
                        { rank: 17, name: 'JYP Ent.', code: '035900', market: 'KOSDAQ', price: 58000, change: -500, rate: -0.85, industry: 'ì—”í„°' },
                        { rank: 18, name: 'ì´ì˜¤í…Œí¬ë‹‰ìŠ¤', code: '039030', market: 'KOSDAQ', price: 175000, change: 3000, rate: 1.74, industry: 'ë°˜ë„ì²´' },
                        { rank: 19, name: 'ë™ì§„ì„ë¯¸ì¼', code: '005290', market: 'KOSDAQ', price: 38000, change: 200, rate: 0.53, industry: 'ë°˜ë„ì²´' },
                        { rank: 20, name: 'ì›ìµIPS', code: '240810', market: 'KOSDAQ', price: 34500, change: 500, rate: 1.47, industry: 'ë°˜ë„ì²´' },
                        { rank: 21, name: 'ì¹´ì¹´ì˜¤ê²Œì„ì¦ˆ', code: '293490', market: 'KOSDAQ', price: 19500, change: -200, rate: -1.02, industry: 'ê²Œì„' },
                        { rank: 22, name: 'ì—ìŠ¤ì— ', code: '041510', market: 'KOSDAQ', price: 72000, change: -1000, rate: -1.37, industry: 'ì—”í„°' },
                        { rank: 23, name: 'íŒŒë§ˆë¦¬ì„œì¹˜', code: '214450', market: 'KOSDAQ', price: 185000, change: 4000, rate: 2.21, industry: 'ì˜ë£Œê¸°ê¸°' },
                        { rank: 24, name: 'CJ ENM', code: '035760', market: 'KOSDAQ', price: 78000, change: 500, rate: 0.65, industry: 'ë¯¸ë””ì–´' },
                        { rank: 25, name: 'ìŠ¤íŠœë””ì˜¤ë“œë˜ê³¤', code: '253450', market: 'KOSDAQ', price: 42000, change: -300, rate: -0.71, industry: 'ë¯¸ë””ì–´' },
                        { rank: 26, name: 'ë”ë¸”ìœ ì”¨í”¼', code: '393890', market: 'KOSDAQ', price: 38000, change: -500, rate: -1.30, industry: '2ì°¨ì „ì§€' },
                        { rank: 27, name: 'ëŒ€ì£¼ì „ìì¬ë£Œ', code: '078600', market: 'KOSDAQ', price: 95000, change: 2000, rate: 2.15, industry: '2ì°¨ì „ì§€' },
                        { rank: 28, name: 'ë‚˜ë…¸ì‹ ì†Œì¬', code: '121600', market: 'KOSDAQ', price: 115000, change: 1500, rate: 1.32, industry: '2ì°¨ì „ì§€' },
                        { rank: 29, name: 'ì œì´ì•¤í‹°ì”¨', code: '204270', market: 'KOSDAQ', price: 22000, change: 800, rate: 3.77, industry: 'ITë¶€í’ˆ' },
                        { rank: 30, name: 'í”¼ì—”í‹°', code: '137400', market: 'KOSDAQ', price: 54000, change: -500, rate: -0.92, industry: '2ì°¨ì „ì§€' },
                        { rank: 31, name: 'ì—ìŠ¤í‹°íŒœ', code: '237690', market: 'KOSDAQ', price: 98000, change: 2000, rate: 2.08, industry: 'ë°”ì´ì˜¤' },
                        { rank: 32, name: 'ì”¨ì  ', code: '096530', market: 'KOSDAQ', price: 24500, change: 100, rate: 0.41, industry: 'ë°”ì´ì˜¤' },
                        { rank: 33, name: 'ISC', code: '095340', market: 'KOSDAQ', price: 78000, change: 1000, rate: 1.30, industry: 'ë°˜ë„ì²´' },
                        { rank: 34, name: 'í‹°ì”¨ì¼€ì´', code: '064760', market: 'KOSDAQ', price: 105000, change: -1000, rate: -0.94, industry: 'ë°˜ë„ì²´' },
                        { rank: 35, name: 'ì£¼ì„±ì—”ì§€ë‹ˆì–´ë§', code: '036930', market: 'KOSDAQ', price: 32000, change: 500, rate: 1.59, industry: 'ë°˜ë„ì²´' },
                        { rank: 36, name: 'SOOP', code: '067160', market: 'KOSDAQ', price: 115000, change: -2000, rate: -1.71, industry: 'í”Œë«í¼' },
                        { rank: 37, name: 'ì™€ì´ì§€ì—”í„°í…Œì¸ë¨¼íŠ¸', code: '122870', market: 'KOSDAQ', price: 38000, change: -500, rate: -1.30, industry: 'ì—”í„°' },
                        { rank: 38, name: 'ë„¥ìŠ¨ê²Œì„ì¦ˆ', code: '225570', market: 'KOSDAQ', price: 15500, change: 200, rate: 1.31, industry: 'ê²Œì„' },
                        { rank: 39, name: 'ë£¨ë‹›', code: '328130', market: 'KOSDAQ', price: 48000, change: 1000, rate: 2.13, industry: 'ì˜ë£ŒAI' },
                        { rank: 40, name: 'HKì´ë…¸ì—”', code: '195940', market: 'KOSDAQ', price: 42000, change: 500, rate: 1.20, industry: 'ì œì•½' },
                        { rank: 41, name: 'íœ´ì˜¨ìŠ¤', code: '243070', market: 'KOSDAQ', price: 32000, change: 100, rate: 0.31, industry: 'ì œì•½' },
                        { rank: 42, name: 'ì—ì´ë¹„ì—˜ë°”ì´ì˜¤', code: '298380', market: 'KOSDAQ', price: 34000, change: 800, rate: 2.41, industry: 'ë°”ì´ì˜¤' },
                        { rank: 43, name: 'ì˜¤ìŠ¤ì½”í…', code: '039200', market: 'KOSDAQ', price: 38000, change: 500, rate: 1.33, industry: 'ë°”ì´ì˜¤' },
                        { rank: 44, name: 'ì°¨ë°”ì´ì˜¤í…', code: '085660', market: 'KOSDAQ', price: 14500, change: -100, rate: -0.68, industry: 'ë°”ì´ì˜¤' },
                        { rank: 45, name: 'ë©”ë””í†¡ìŠ¤', code: '086900', market: 'KOSDAQ', price: 142000, change: -2000, rate: -1.39, industry: 'ë°”ì´ì˜¤' },
                        { rank: 46, name: 'íŒŒí¬ì‹œìŠ¤í…œìŠ¤', code: '140860', market: 'KOSDAQ', price: 165000, change: 3000, rate: 1.85, industry: 'ë°˜ë„ì²´' },
                        { rank: 47, name: 'ê³ ì˜', code: '098460', market: 'KOSDAQ', price: 13500, change: 100, rate: 0.75, industry: 'ë°˜ë„ì²´' },
                        { rank: 48, name: 'ì‹¬í…', code: '222800', market: 'KOSDAQ', price: 24000, change: -200, rate: -0.83, industry: 'ë°˜ë„ì²´' },
                        { rank: 49, name: 'í•˜ë‚˜ë§ˆì´í¬ë¡ ', code: '067310', market: 'KOSDAQ', price: 18500, change: 300, rate: 1.65, industry: 'ë°˜ë„ì²´' },
                        { rank: 50, name: 'ë‘ì‚°í…ŒìŠ¤ë‚˜', code: '131970', market: 'KOSDAQ', price: 38000, change: 500, rate: 1.33, industry: 'ë°˜ë„ì²´' },
                        { rank: 51, name: 'ë¹„ì—ì´ì¹˜', code: '090460', market: 'KOSDAQ', price: 19500, change: 200, rate: 1.04, industry: 'ITë¶€í’ˆ' },
                        { rank: 52, name: 'ì— ë¡œ', code: '058970', market: 'KOSDAQ', price: 62000, change: 1000, rate: 1.64, industry: 'ì†Œí”„íŠ¸ì›¨ì–´' },
                        { rank: 53, name: 'ì¹´í˜24', code: '042000', market: 'KOSDAQ', price: 28000, change: -500, rate: -1.75, industry: 'í”Œë«í¼' },
                        { rank: 54, name: 'ì•„í”„ë¦¬ì¹´TV', code: '067160', market: 'KOSDAQ', price: 105000, change: -1000, rate: -0.94, industry: 'í”Œë«í¼' },
                        { rank: 55, name: 'ìœ„ë©”ì´ë“œ', code: '112040', market: 'KOSDAQ', price: 42000, change: -1000, rate: -2.33, industry: 'ê²Œì„' },
                        { rank: 56, name: 'ì²œë³´', code: '278280', market: 'KOSDAQ', price: 75000, change: -1500, rate: -1.96, industry: '2ì°¨ì „ì§€' },
                        { rank: 57, name: 'ì„±ìš°í•˜ì´í…', code: '015750', market: 'KOSDAQ', price: 8500, change: 50, rate: 0.59, industry: 'ìë™ì°¨' },
                        { rank: 58, name: 'ì„œì§„ì‹œìŠ¤í…œ', code: '178320', market: 'KOSDAQ', price: 26000, change: 500, rate: 1.96, industry: 'í†µì‹ ì¥ë¹„' },
                        { rank: 59, name: 'ì¸í…”ë¦¬ì•ˆí…Œí¬', code: '189300', market: 'KOSDAQ', price: 58000, change: 1000, rate: 1.75, industry: 'í†µì‹ ì¥ë¹„' },
                        { rank: 60, name: 'ì œì¼ì— ì•¤ì—ìŠ¤', code: '456789', market: 'KOSDAQ', price: 18000, change: 200, rate: 1.12, industry: '2ì°¨ì „ì§€' }
                    ]
                };
                
                // ì‹œë®¬ë ˆì´í„° DB
                this.currentDB = JSON.parse(JSON.stringify(this.initialDB));
            }

            simulateChange(currentPrice) {
                let step;
                if (currentPrice > 500000) step = 1000;
                else if (currentPrice > 100000) step = 500;
                else if (currentPrice > 50000) step = 100;
                else if (currentPrice > 10000) step = 50;
                else step = 10;

                const direction = Math.random() > 0.45 ? 1 : -1; 
                const magnitude = Math.floor(Math.random() * 3) + 1;
                let changeAmount = step * magnitude * direction;

                const newPrice = Math.max(100, currentPrice + changeAmount);
                const changeRate = ((newPrice - currentPrice) / currentPrice) * 100;

                return { newPrice, changeAmount, changeRate };
            }

            async fetchGlobalData() {
                // TODO: fetch('http://localhost:5000/api/global')
                return new Promise(resolve => {
                    setTimeout(() => {
                        this.currentDB.global.forEach(item => {
                            const fluc = (Math.random() - 0.5) * (item.value * 0.001);
                            item.value += fluc;
                        });
                        resolve(this.currentDB.global);
                    }, 200);
                });
            }

            async fetchStocks(marketFilter) {
                // TODO: fetch(`http://localhost:5000/api/stocks?market=${marketFilter}`)
                return new Promise(resolve => {
                    setTimeout(() => {
                        const data = this.currentDB.stocks.filter(s => 
                            marketFilter === 'ALL' ? true : s.market === marketFilter
                        );
                        resolve(data);
                    }, 200);
                });
            }

            // [ì„œë²„ API ëŒ€ì²´] ì‹¤ì‹œê°„ ê°€ê²© (ì•¼í›„ íŒŒì´ë‚¸ìŠ¤ ëŒ€ì²´)
            async fetchRealtimePrice(code) {
                // Vercel ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ ì—”ë“œí¬ì¸íŠ¸: /api/realtime?code=...
                const PROXY_URL = `/api/realtime?code=${code}`;
                
                // --- ì‹¤ì œ API í˜¸ì¶œ ì‹œ ì£¼ì„ í•´ì œí•  ë¶€ë¶„ (Vercel ë°°í¬ ì™„ë£Œ í›„) ---
                /*
                try {
                    const res = await fetch(PROXY_URL);
                    if (!res.ok) throw new Error('API ì„œë²„ ì˜¤ë¥˜');
                    const realData = await res.json();
                    
                    // KOSDAQ ì¢…ëª© ì‹¬ë³¼ì„ ê¸°ì¤€ìœ¼ë¡œ ì•¼í›„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤ê³  ê°€ì •
                    const stock = this.currentDB.stocks.find(s => s.code === code);
                    stock.price = realData.price;
                    stock.change = realData.change;
                    stock.rate = realData.rate;
                    return stock;

                } catch (e) {
                    console.error("Failed to fetch real data, falling back to simulation:", e);
                    // ì‹¤íŒ¨ ì‹œ ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„° ë°˜í™˜ ë¡œì§ìœ¼ë¡œ ëŒ€ì²´
                }
                */
                // --------------------------------------------------------
                
                // [í˜„ì¬ ì‹œë®¬ë ˆì´ì…˜ ì½”ë“œ ìœ ì§€]
                return new Promise(resolve => {
                    setTimeout(() => {
                        const stock = this.currentDB.stocks.find(s => s.code === code);
                        if(stock) {
                            const { newPrice } = this.simulateChange(stock.price);
                            stock.change += (newPrice - stock.price);
                            stock.price = newPrice;
                            stock.rate = parseFloat(((stock.change / (stock.price - stock.change)) * 100).toFixed(2));
                            resolve(stock);
                        }
                    }, 100);
                });
            }
        }

        class DashboardApp {
            constructor() {
                this.api = new StockApiService();
                this.state = {
                    currentMarket: 'KOSDAQ',
                    activeCode: null,
                    chartPeriod: 'DAY',
                    stocks: []
                };
                this.updateTimer = null;
            }

            async init() {
                this.updateTime();
                setInterval(() => this.updateTime(), 60000);
                
                await this.refreshData();
                this.startLiveUpdate(); // ë¼ì´ë¸Œ ëª¨ë“œ ì‹œì‘
            }

            updateTime() {
                const now = new Date();
                const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                document.getElementById('last-updated').textContent = `Updated ${timeStr}`;
            }

            async refreshData() {
                document.getElementById('loading-overlay').classList.remove('hidden');
                const [global, stocks] = await Promise.all([
                    this.api.fetchGlobalData(),
                    this.api.fetchStocks(this.state.currentMarket)
                ]);
                
                this.renderGlobal(global);
                this.state.stocks = stocks;
                this.renderGrid(); // ê·¸ë£¹í™”ëœ ê·¸ë¦¬ë“œ ë Œë”ë§ í˜¸ì¶œ
                
                if(!this.state.activeCode && stocks.length > 0) {
                    this.selectStock(stocks[0].code);
                }
                document.getElementById('loading-overlay').classList.add('hidden');
            }

            // ì‹¤ì‹œê°„ ê°€ê²© ì—…ë°ì´íŠ¸ ë£¨í”„
            startLiveUpdate() {
                if(this.updateTimer) clearInterval(this.updateTimer);
                this.updateTimer = setInterval(async () => {
                    if(this.state.activeCode) {
                        const stock = await this.api.fetchRealtimePrice(this.state.activeCode);
                        this.updateDetailPanel(stock);
                        
                        // [ì¤‘ìš”] ê·¸ë¦¬ë“œ ìƒì˜ ë°ì´í„°ë„ ì—…ë°ì´íŠ¸ (ê°€ê²© ë“±)
                        this.updateGridItem(stock);
                    }
                }, 2000); // 2ì´ˆ ì£¼ê¸°
            }

            updateGridItem(stock) {
                // í™”ë©´ì— ë³´ì´ëŠ” í•´ë‹¹ ì¢…ëª© ì¹´ë“œë§Œ ì½• ì§‘ì–´ì„œ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
                const card = document.querySelector(`.stock-item[onclick="app.selectStock('${stock.code}')"]`);
                if(card) {
                    const priceEl = card.querySelector('.stock-price');
                    const rateEl = card.querySelector('.stock-rate');
                    if(priceEl) priceEl.textContent = stock.price.toLocaleString();
                    if(rateEl) {
                        const isUp = stock.rate > 0;
                        rateEl.textContent = `${stock.rate}%`;
                        rateEl.className = `stock-rate text-sm font-bold ${isUp ? 'text-up' : 'text-down'}`;
                    }
                }
            }

            setFilter(market) {
                this.state.currentMarket = market;
                this.updateFilterUI();
                this.refreshData();
            }

            updateFilterUI() {
                ['all', 'kospi', 'kosdaq'].forEach(m => {
                    const btn = document.getElementById(`filter-${m}`);
                    const active = m === this.state.currentMarket.toLowerCase();
                    btn.className = `px-3 py-1.5 text-xs font-bold rounded-md transition-all ${active ? 'bg-indigo-600 text-white' : 'text-slate-500 hover:bg-slate-200'}`;
                });
            }

            selectStock(code) {
                this.state.activeCode = code;
                const stock = this.state.stocks.find(s => s.code === code);
                
                // ê¸°ì¡´ active í´ë˜ìŠ¤ ì œê±° ë° ì¶”ê°€
                document.querySelectorAll('.stock-item').forEach(el => el.classList.remove('active'));
                const card = document.querySelector(`.stock-item[onclick="app.selectStock('${code}')"]`);
                if(card) card.classList.add('active');
                
                if(stock) {
                    document.getElementById('detail-name').textContent = stock.name;
                    document.getElementById('detail-code').textContent = stock.code;
                    document.getElementById('detail-industry').textContent = stock.industry;
                    document.getElementById('detail-badge').textContent = stock.market;
                    
                    this.updateDetailPanel(stock);
                    this.renderChartPlaceholder(stock);
                    
                    document.getElementById('dart-link').href = `https://dart.fss.or.kr/dsac001/main.do?&textCrpNm=${encodeURIComponent(stock.name)}`;
                    document.getElementById('naver-talk-link').href = `https://finance.naver.com/item/board.naver?code=${stock.code}`;
                }
            }

            updateDetailPanel(stock) {
                const elPrice = document.getElementById('detail-price');
                const elChange = document.getElementById('detail-change');
                const oldPrice = parseInt(elPrice.textContent.replace(/,/g, '')) || 0;
                
                const isUp = stock.rate > 0;
                const color = isUp ? 'text-up' : 'text-down';
                
                // ê°€ê²© ë³€ë™ ì‹œ ë°°ê²½ìƒ‰ ê¹œë¹¡ì„ íš¨ê³¼
                if(stock.price !== oldPrice) {
                    const box = document.getElementById('price-container');
                    // ì´ì „ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì œê±° í›„ ì¬ì ìš©
                    box.classList.remove('flash-up', 'flash-down');
                    void box.offsetWidth; // trigger reflow
                    box.classList.add(stock.price > oldPrice ? 'flash-up' : 'flash-down');
                }

                elPrice.className = `text-3xl font-black num-font ${color}`;
                elPrice.textContent = stock.price.toLocaleString();
                
                elChange.className = `text-md font-bold num-font ${color}`;
                elChange.textContent = `${stock.change > 0 ? 'â–²' : 'â–¼'} ${Math.abs(stock.change).toLocaleString()}`;
                
                const elRate = document.getElementById('detail-rate');
                elRate.className = `px-2 py-0.5 rounded text-[10px] font-bold num-font ${isUp ? 'bg-up' : 'bg-down'}`;
                elRate.textContent = `${stock.rate}%`;

                const low = stock.price * 0.98;
                const high = stock.price * 1.02;
                const percent = Math.max(0, Math.min(100, ((stock.price - low) / (high - low)) * 100));
                document.getElementById('sim-low').textContent = Math.floor(low).toLocaleString();
                document.getElementById('sim-high').textContent = Math.floor(high).toLocaleString();
                document.getElementById('price-dot').style.left = `${percent}%`;
            }

            renderGlobal(data) {
                const container = document.getElementById('global-stats');
                container.innerHTML = data.map(item => {
                    const isUp = item.change > 0;
                    const color = isUp ? 'text-up' : 'text-down';
                    return `
                        <div class="global-card">
                            <div class="text-[10px] font-bold text-slate-500 mb-0.5 truncate">${item.name}</div>
                            <div class="flex items-end justify-between">
                                <span class="text-sm font-black text-slate-800 num-font">${item.value.toLocaleString()}</span>
                                <div class="text-right leading-none">
                                    <span class="text-[10px] font-bold ${color}">${item.change > 0 ? '+' : ''}${item.change.toLocaleString(undefined, { minimumFractionDigits: item.change % 1 !== 0 ? 2 : 0, maximumFractionDigits: 2 })}</span>
                                    <br>
                                    <span class="text-[10px] font-bold ${color} opacity-80">${item.rate}%</span>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // [ë³µì›ëœ ê¸°ëŠ¥] ì„¹í„°ë³„ ê·¸ë£¹í™” ê·¸ë¦¬ë“œ ë Œë”ë§
            renderGrid() {
                const container = document.getElementById('industry-grid');
                
                // 1. ë°ì´í„°ë¥¼ ì‚°ì—…(Industry)ë³„ë¡œ ê·¸ë£¹í™”
                const grouped = this.state.stocks.reduce((acc, stock) => {
                    const k = stock.industry;
                    if (!acc[k]) acc[k] = [];
                    acc[k].push(stock);
                    return acc;
                }, {});

                // 2. ê·¸ë£¹ë³„ ì¹´ë“œ ìƒì„±
                container.innerHTML = Object.keys(grouped).map(industry => {
                    const stocks = grouped[industry];
                    const market = stocks[0].market;
                    const icon = this.getIndustryIcon(industry); // ì•„ì´ì½˜ í—¬í¼ ì‚¬ìš©

                    // ê° ì‚°ì—… ë‚´ ì¢…ëª© ë¦¬ìŠ¤íŠ¸ ìƒì„±
                    const itemsHtml = stocks.map(stock => {
                        const isUp = stock.rate > 0;
                        const colorClass = isUp ? 'text-up' : 'text-down';
                        const active = this.state.activeCode === stock.code ? 'active' : '';
                        
                        // ë±ƒì§€ ë¡œì§
                        let badgeClass = 'badge-default';
                        let badgeText = `Rank ${stock.rank}`;
                        if (stock.rank <= 3) { badgeClass = 'badge-red'; badgeText = 'ğŸ”¥ Top 3'; }
                        else if (stock.rank <= 10) { badgeClass = 'badge-top10'; badgeText = 'ğŸš€ Top 10'; }
                        else if (stock.rank <= 20) { badgeClass = 'badge-top20'; badgeText = 'ğŸŒŸ Top 20'; }
                        else if (stock.rank <= 30) { badgeClass = 'badge-top30'; badgeText = 'âœ¨ Top 30'; }

                        const marketAbbr = stock.market === 'KOSPI' ? '(K)' : '(Q)';

                        // ì‹œì´ ê³„ì‚° (ëŒ€ëµì )
                        const cap = (stock.price * (100 - stock.rank) * 10000 / 1000000000000).toFixed(1);

                        return `
                            <div class="stock-item ${active}" onclick="app.selectStock('${stock.code}')">
                                <div class="flex flex-col space-y-1">
                                    <div class="flex items-start justify-between">
                                        <span class="text-sm font-bold text-slate-800 truncate leading-snug">${stock.name}${marketAbbr}</span>
                                        <span class="rank-badge-top ${badgeClass} text-[10px] font-extrabold">${badgeText}</span>
                                    </div>
                                    <div class="flex flex-col">
                                        <!-- ê°€ê²© ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ í´ë˜ìŠ¤ ì¶”ê°€: stock-price -->
                                        <span class="stock-price text-xl font-black num-font text-slate-900 leading-tight">${stock.price.toLocaleString()}</span>
                                        <span class="text-[10px] font-medium text-slate-500 whitespace-nowrap mt-0.5">ì‹œì´: ${cap}ì¡°ì›</span>
                                    </div>
                                    <div class="flex items-center">
                                        <!-- ë“±ë½ë¥  ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ í´ë˜ìŠ¤ ì¶”ê°€: stock-rate -->
                                        <span class="stock-rate text-sm font-bold ${colorClass} num-font">${stock.rate}%</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');

                    // ì‚°ì—… ì¹´ë“œ ë˜í¼ ë°˜í™˜
                    return `
                        <div class="main-section-card overflow-hidden">
                            <div class="bg-white px-4 py-3 border-b border-slate-100 flex justify-between items-center rounded-t-xl">
                                <h3 class="text-sm font-extrabold text-slate-800 flex items-center">
                                    ${icon}
                                    <span>${industry} (${market})</span>
                                    <span class="text-xs font-semibold text-slate-500 ml-2">(${stocks.length}ê°œ)</span>
                                </h3>
                            </div>
                            <div class="p-3 grid grid-cols-2 gap-3 bg-gray-50">
                                ${itemsHtml}
                            </div>
                        </div>
                    `;
                }).join('');
                
                // ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ì„¤ì • ë³µì› (ë‹¨ìˆœ gridê°€ ì•„ë‹Œ ì¹´ë“œë“¤ì˜ ë‚˜ì—´)
                container.className = "grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3";
            }

            // [ë³µì›ëœ ê¸°ëŠ¥] ì‚°ì—… ì•„ì´ì½˜ í—¬í¼
            getIndustryIcon(industry) {
                const h = "h-6 w-6 sector-icon"; 
                const stroke = "stroke-2.5";
                
                // ì£¼ìš” ì„¹í„° ì•„ì´ì½˜ ë§¤í•‘
                if(industry === 'ë°˜ë„ì²´' || industry === 'ITë¶€í’ˆ' || industry === 'ITê°€ì „' || industry === 'ITì„œë¹„ìŠ¤') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-indigo-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M7 7h10"/><path d="M7 17h10"/><path d="M7 12h10"/><path d="M12 7v10"/></svg>`;
                if(industry === '2ì°¨ì „ì§€') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-emerald-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="10" width="18" height="12" rx="2"/><path d="M21 6H3"/><path d="M12 14v-4l-3 4h6"/></svg>`;
                if(industry.includes('ë°”ì´ì˜¤') || industry.includes('ì œì•½') || industry.includes('ì˜ë£ŒAI') || industry.includes('ì˜ë£Œê¸°ê¸°')) return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-pink-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><path d="M10 2a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2M14 2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2M18 7.5L14 12l4 4.5M6 7.5L10 12l-4 4.5"/></svg>`;
                if(industry === 'ìë™ì°¨') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-slate-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><path d="M12 14s.5 2.5 2.5 2.5c2 0 4.5-2.5 4.5-2.5s-2.5-4.5-4.5-4.5c-2 0-2.5 2.5-2.5 2.5z"/><path d="M12 14l-4 4"/><circle cx="12" cy="12" r="10"/></svg>`;
                if(industry === 'ê¸ˆìœµ' || industry === 'ë³´í—˜') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-green-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3v18"/><path d="M18 13.5l-6-3-6 3"/><path d="M12 6.5L6 9.5m6-3l6 3"/><rect x="3" y="16" width="6" height="4" rx="1"/><rect x="15" y="16" width="6" height="4" rx="1"/></svg>`;
                if(industry === 'í”Œë«í¼' || industry === 'ê²Œì„' || industry === 'ë¯¸ë””ì–´' || industry === 'ì—”í„°') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-orange-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><path d="M6 12h4"/><path d="M8 10v4"/><path d="M15 11h2"/><path d="M16 10v4"/><rect x="2" y="4" width="20" height="16" rx="7"/></svg>`;
                if(industry === 'ì² ê°•' || industry.includes('í™”í•™') || industry.includes('ì •ìœ ')) return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-gray-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><path d="M2 20h20"/><path d="M6 20v-4"/><path d="M18 20v-4"/><path d="M12 20v-8"/><path d="M4 16v-2c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v2"/><path d="M9 12h6"/><path d="M15 12V6c0-1.1-.9-2-2-2h-2c-1.1 0-2 .9-2 2v6"/></svg>`;
                if(industry === 'ì¡°ì„ ' || industry === 'í•´ìš´' || industry === 'í•­ê³µ' || industry === 'ë¬¼ë¥˜') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-blue-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><path d="M4 20h16"/><path d="M8 12h8"/><path d="M6 16l-3-4h18l-3 4z"/><path d="M10 8l2-4 2 4"/></svg>`;
                if(industry === 'ê¸°ê³„' || industry === 'ë°©ì‚°') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-red-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.4 1.4 0 0 0-.8-2.6l-3.2-1.2v-3.2a1.4 1.4 0 0 0-2.6-.8l-1.2 3.2H7.6a1.4 1.4 0 0 0-.8 2.6l3.2 1.2v3.2a1.4 1.4 0 0 0 2.6.8l1.2-3.2h3.2a1.4 1.4 0 0 0 .8-2.6z"/></svg>`;
                if(industry === 'ìŒì‹ë£Œ' || industry === 'í™”ì¥í’ˆ' || industry === 'ì˜ë¥˜') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-lime-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.38a2 2 0 0 0 2-1.58L23 6H6"/></svg>`;
                if(industry === 'ìœ í‹¸ë¦¬í‹°') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-yellow-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`;
                if(industry === 'ì§€ì£¼ì‚¬') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-purple-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="10" width="18" height="12" rx="2"/><line x1="12" y1="2" x2="12" y2="10"/><line x1="7" y1="14" x2="7" y2="18"/><line x1="17" y1="14" x2="17" y2="18"/></svg>`;
                if(industry === 'ë ˆì €') return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-cyan-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`;

                return `<svg xmlns="http://www.w3.org/2000/svg" class="${h} mr-2 text-gray-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="${stroke}" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>`;
            }

            renderChartPlaceholder(stock) {
                 // ì°¨íŠ¸ ê¸°ê°„ ì„¤ì • ë¡œì§ (ìƒëµ - UIë§Œ ìœ ì§€)
            }
            setChartPeriod(period) {
                // UI ê°±ì‹ ë§Œ
                document.querySelectorAll('.chart-button').forEach(b => b.classList.remove('active'));
                document.getElementById(`chart-${period.toLowerCase()}`).classList.add('active');
            }
        }

        const app = new DashboardApp();
        app.init();
    </script>
</body>
</html>